{
  "active": true,
  "connections": {
    "When clicking ‘Test workflow’": {
      "main": [
        []
      ]
    },
    "GPT 4.1 Mini2": {
      "ai_languageModel": [
        []
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Team Composition",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Team Composition",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Combine Requirements",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Combine Requirements": {
      "main": [
        [
          {
            "node": "Combined Requirements Output",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combined Requirements Output": {
      "main": [
        [
          {
            "node": "Dependencies1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dependencies1": {
      "main": [
        [
          {
            "node": "Prepare for frontend9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Team Composition1": {
      "ai_outputParser": [
        [
          {
            "node": "Team Composition",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Team Composition": {
      "main": [
        [
          {
            "node": "Team Composition Output",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Team Composition Output": {
      "main": [
        [
          {
            "node": "Prepare for frontend11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Greenfield + Rationale": {
      "ai_outputParser": [
        [
          {
            "node": "Effort Estimation",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "GPT 4.1 Mini4": {
      "ai_languageModel": [
        []
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Effort Estimation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "Effort Estimation",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Effort Estimation",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Greenfield + Rationale3": {
      "ai_outputParser": [
        [
          {
            "node": "Development Plan",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "Development Plan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Development Plan",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Calculator1": {
      "ai_tool": [
        [
          {
            "node": "Development Plan",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Effort Estimation": {
      "main": [
        [
          {
            "node": "Effort Estimate Output",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Effort Estimate Output": {
      "main": [
        [
          {
            "node": "Prepare for frontend12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start RFP Analysis": {
      "main": [
        [
          {
            "node": "Add Execution id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for frontend9": {
      "main": [
        [
          {
            "node": "SSE - Requirements",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SSE - Requirements": {
      "main": [
        [
          {
            "node": "Prepare Queries - Techstack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for frontend11": {
      "main": [
        [
          {
            "node": "SSE - Team Composition",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SSE - Team Composition": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for frontend12": {
      "main": [
        [
          {
            "node": "SSE - Effort Estimation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SSE - Effort Estimation": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for frontend13": {
      "main": [
        [
          {
            "node": "SSE - Development Plan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Development Plan": {
      "main": [
        [
          {
            "node": "Development Plan Output",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Reporter",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Reporter": {
      "main": [
        [
          {
            "node": "Prepare for frontend7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for frontend7": {
      "main": [
        [
          {
            "node": "SSE - Final Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SSE - Development Plan": {
      "main": [
        [
          {
            "node": "Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prompt": {
      "main": [
        [
          {
            "node": "Reporter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Development Plan Output": {
      "main": [
        [
          {
            "node": "Prepare for frontend13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculator2": {
      "ai_tool": [
        [
          {
            "node": "Reporter",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think2": {
      "ai_tool": [
        [
          {
            "node": "Reporter",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "mock": {
      "main": [
        []
      ]
    },
    "Send PDF to Email": {
      "main": [
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "SSE - Final Report": {
      "main": [
        []
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Combine Requirements",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model8": {
      "ai_languageModel": [
        []
      ]
    },
    "RFP Upload": {
      "main": [
        []
      ]
    },
    "Prepare for frontend": {
      "main": [
        [
          {
            "node": "SSE - Document Preparation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SSE - Document Preparation": {
      "main": [
        [
          {
            "node": "Prepare Queries - Platforms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Table Exist": {
      "main": [
        [
          {
            "node": "If table exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If table exists": {
      "main": [
        [
          {
            "node": "Is Table Populated",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create RFP Table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Table Populated": {
      "main": [
        [
          {
            "node": "If table populated",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If table populated": {
      "main": [
        [
          {
            "node": "Prepare for frontend",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "File Ingestion - Full1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create RFP Table": {
      "main": [
        [
          {
            "node": "File Ingestion - Full",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Execution id": {
      "main": [
        [
          {
            "node": "Check Table Exist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "File Ingestion - Full": {
      "main": [
        [
          {
            "node": "Prepare for frontend",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete row(s)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "File Ingestion - Full1": {
      "main": [
        [
          {
            "node": "Prepare for frontend",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete row(s)2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete row(s)1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete row(s)2": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Platforms + Rationale1": {
      "ai_outputParser": [
        [
          {
            "node": "Get Platforms",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Think3": {
      "ai_tool": [
        [
          {
            "node": "Get Platforms",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "PreparePrompts - Platforms": {
      "main": [
        [
          {
            "node": "Get Platforms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Platforms": {
      "main": [
        [
          {
            "node": "Parse With Citations - Platforms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse With Citations - Platforms": {
      "main": [
        [
          {
            "node": "Downstream LLM Output - Platforms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Downstream LLM Output - Platforms": {
      "main": [
        [
          {
            "node": "Prepare for frontend - Platforms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for frontend - Platforms": {
      "main": [
        [
          {
            "node": "SSE - Platforms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SSE - Platforms": {
      "main": [
        [
          {
            "node": "Prepare Queries - FN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GPT 4.1-Mini": {
      "ai_languageModel": [
        [
          {
            "node": "Get Platforms",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "PreparePrompts - Platforms Confidence": {
      "main": [
        [
          {
            "node": "Get Platforms Confidences",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Get Platforms Confidences",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Get Platforms Confidences": {
      "main": [
        [
          {
            "node": "Map confidence to platforms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map confidence to platforms": {
      "main": [
        []
      ]
    },
    "Platforms Retrieve Chunks": {
      "main": [
        [
          {
            "node": "PreparePrompts - Platforms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Queries - Platforms": {
      "main": [
        [
          {
            "node": "Platforms Retrieve Chunks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Think4": {
      "ai_tool": [
        [
          {
            "node": "Get Functional Requirements",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "GPT 4.1-Mini1": {
      "ai_languageModel": [
        [
          {
            "node": "Get Functional Requirements",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser2": {
      "ai_outputParser": [
        [
          {
            "node": "Get FN Confidences",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Get Functional Requirements": {
      "main": [
        [
          {
            "node": "Parse With Citations - FN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Queries - FN": {
      "main": [
        [
          {
            "node": "FN Retrieve Chunks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FN Retrieve Chunks": {
      "main": [
        [
          {
            "node": "PreparePrompts - FN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PreparePrompts - FN": {
      "main": [
        [
          {
            "node": "Get Functional Requirements",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FN": {
      "ai_outputParser": [
        [
          {
            "node": "Get Functional Requirements",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Parse With Citations - FN": {
      "main": [
        [
          {
            "node": "Downstream LLM Output - FN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Prompts - FN Confidence": {
      "main": [
        [
          {
            "node": "Get FN Confidences",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FN Confidences": {
      "main": [
        [
          {
            "node": "Map confidence to FN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map confidence to FN": {
      "main": [
        []
      ]
    },
    "Downstream LLM Output - FN": {
      "main": [
        [
          {
            "node": "Prepare Queries - NN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GPT 4.1-Mini2": {
      "ai_languageModel": [
        [
          {
            "node": "Get Non-Functional Requirements",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser3": {
      "ai_outputParser": [
        [
          {
            "node": "Get NN Confidences",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Queries - NN": {
      "main": [
        [
          {
            "node": "NN Retrieve Chunks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NN Retrieve Chunks": {
      "main": [
        [
          {
            "node": "PreparePrompts - NN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PreparePrompts - NN": {
      "main": [
        [
          {
            "node": "Get Non-Functional Requirements",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Non-Functional Requirements": {
      "main": [
        [
          {
            "node": "Parse With Citations - NN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NN": {
      "ai_outputParser": [
        [
          {
            "node": "Get Non-Functional Requirements",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Parse With Citations - NN": {
      "main": [
        [
          {
            "node": "Downstream LLM Output - NN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Prompts - NN Confidence": {
      "main": [
        [
          {
            "node": "Get NN Confidences",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get NN Confidences": {
      "main": [
        [
          {
            "node": "Map confidence to NN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map confidence to NN": {
      "main": [
        []
      ]
    },
    "Downstream LLM Output - NN": {
      "main": [
        [
          {
            "node": "Combine Requirements",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Think6": {
      "ai_tool": [
        [
          {
            "node": "Get Techstack2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "GPT 4.1-Mini3": {
      "ai_languageModel": [
        []
      ]
    },
    "Prepare Queries - Techstack": {
      "main": [
        [
          {
            "node": "Techstack Retrieve Chunks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Techstack Retrieve Chunks": {
      "main": [
        [
          {
            "node": "PreparePrompts - Techstack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PreparePrompts - Techstack": {
      "main": [
        [
          {
            "node": "Get Techstack2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Techstack2": {
      "main": [
        [
          {
            "node": "Parse With Citations - Techstack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Techstack": {
      "ai_outputParser": [
        [
          {
            "node": "Get Techstack2",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Parse With Citations - Techstack": {
      "main": [
        [
          {
            "node": "Techstack Output1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for frontend14": {
      "main": [
        [
          {
            "node": "SSE - Techstack1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Techstack Output1": {
      "main": [
        [
          {
            "node": "Prepare for frontend14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SSE - Techstack1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        []
      ]
    },
    "Anthropic Chat Model6": {
      "ai_languageModel": [
        []
      ]
    },
    "Anthropic Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Get Techstack2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-11T13:21:49.057Z",
  "id": "Ky1AiuIMbY1zoTLE",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "RFP Analysis Public - Supabase",
  "nodes": [
    {
      "parameters": {},
      "id": "33f0ef03-bf6d-43f0-b678-c0b9d7939009",
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -3936,
        1632
      ],
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Inference PLATFORMS\nYou are reviewing excerpts \nfrom an RFP document \nto determine which technology \nplatforms are explicitly required.\n\nUse only the following categories:\n- Web applications\n- Mobile apps (mention iOS/Android if stated)\n- Backend/API services\n- Admin portals or dashboards\n- Desktop applications\n- Specialized systems (e.g., kiosks, IoT)\n\nFor each platform you identify, \nexplain briefly what in the text\n led you to that conclusion.\nOnly include platforms that are\n clearly required or described.\n\nIf nothing is clear, say \n“No platform requirements explicitly stated.”",
        "height": 524,
        "width": 2904
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4544,
        2976
      ],
      "id": "01b2ecb3-196b-4d7e-8b0b-f658db7fbcda",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {
          "temperature": 0.1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1040,
        5360
      ],
      "id": "f200bedd-af18-4b67-978d-21b62a0e2702",
      "name": "GPT 4.1 Mini2",
      "credentials": {
        "openAiApi": {
          "id": "M8xqWvEC6mH6LNuk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -720,
        5104
      ],
      "id": "33777b24-bddf-4c66-a58e-71c26e74ab55",
      "name": "Team Composition",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "/* n8n Function node\n   Builds the prompt for the “Team-Composition” LLM step.\n   ➜  Output JSON: { systemPrompt, userPrompt }\n*/\n\n// ---------------------------------------------------------------------------\n// 1. Collect fixed snippets prepared in earlier steps\n// ---------------------------------------------------------------------------\nconst {\n   detectedPlatformsSnippet,\n} = $('Dependencies1').first().json;\n\n// Optional extra RAG context (not mandatory)\nconst techstack = $('Techstack Output1').first().json.detectedTechStackSnippet;\n\n// ---------------------------------------------------------------------------\n// 2. Static system prompt (sent once per LLM call)\n// ---------------------------------------------------------------------------\nconst systemPrompt =\n  'You are a senior delivery manager who produces concise team-composition plans ' +\n  'for software projects. Merge the fixed project constraints below with standard ' +\n  'Agile delivery practice. Output **only** a valid JSON object under the key \"team_plan\".';\n\n// ---------------------------------------------------------------------------\n// 3. Dynamic user prompt assembled from all snippets plus rules\n// ---------------------------------------------------------------------------\nconst userPrompt = `\nONLY output the JSON object—no other text.\n\n### CONTEXT_SNIPPETS\n\n${techstack}\n\n${detectedPlatformsSnippet}\n\n### TASK\nDefine the delivery roles needed to execute this project in line with the timeline and constraints.\nDo **not** estimate sprints, person-days, rates, or buffers—those will be calculated later.\nJust list each role, its seniority (e.g. Mid, Senior, Principal), and the average full-time-equivalent (FTE) allocation over the core delivery period.\n\n### DEFAULT & FALLBACK RULES\n\n-  Platform-driven roles:\n  • \"Web applications\" ⇒ Frontend Developer (React, Next.js)\n  • \"Mobile apps\" ⇒ Mobile Developer (Flutter by default; Swift/Kotlin if native)\n  • \"Admin portal\" ⇒ Frontend Developer with design system experience (Shadcn, Material UI)\n  • \"Backend/API services\" ⇒ Backend Developer (PHP Symfony, Node.js, or inferred)\n  • \"CMS\" or content-heavy site ⇒ CMS Developer or Content Specialist\n\nBy default add 1 Solution Arhitect at 30% -  depending on the complexity.\n\nBy default we have 1 project manager and 1 business analyst.\nIf the project is not too complex, use one Hybrid role (50% Project Manager and 50% Business Analyst) - Called: Product Manager.\n\n-  If compliance is \"Moderately Regulated\" or stricter:\n  • Add 1 QA Engineer minimum but in 30%\n  • Mention security-aware development practices in rationale\n  If compliance is \"Highly Regulated\":\n  add 1 QA at 50%\n\n-  If deployment seems classic (implicit or explicit):\n  • Add DevOps Engineer at 25% - if its complicated then add it at 50%\n\n-  If mobile apps required:\n  • Prefer Flutter unless RFP clearly prefers native (then Swift/Kotlin)\nIf Flutter, use 1 Flutter developer.\nIf iOS & Android, user 1 for each.\n\n-  If analytics, SEO, or tracking required:\n  • Include Analytics Specialist or Web Analyst at 30%\n\n-  If project includes “training”, “handover”, or “documentation”:\n  • Add Knowledge Transfer Lead or Documentation Specialist\n\n-  If delivery_model is “Full launch”:\n  • Treat it as a single delivery phase\n\n-  If MVP, phased delivery, or iterations mentioned:\n  • Scale team accordingly across delivery periods if needed\n\n-  If functional scope is large or complex (based on feature count or diversity):\n  • Increase number of developers or FTE allocation\n\n  -  If time line is tight:\n  • Increase number of developers or FTE allocation\n\n-  If 3rd party integrations like CRM, ERP, SSO, Stripe, etc. are required:\n  • Add some percentage to Solution Arhitect \n\n  If development aproach would be Heavily AI Generated code with Shadcn:\n  Don't add Designers. Add just one 100% NodeJS developer for development.\n  If Design is custom or if the project needs it, put 1 Designer at about 30%.\n\n  If the project needs AI, add 1 AI Engineer and, if data preparation is needed, add 1 Data Engineer.\n\n  If any requirement mentions login, authentication, payments, user roles, or GDPR, consider adding 10% to QA Engineer or Solution Architect FTE for security tasks.\n\n-  Rationale must:\n  • Start with **Extracted:**, **Inferred:**, or **Defaulted:**\n  • Be ≤ 200 words\n  • Mention platform/stack mapping to skills\n  • Justify any specialized roles added\n  **IMPORTANT: Format the rationale field using markdown markup for better readability:**\n- Use **bold text** for key points and important terms\n- Use ## headers for main sections\n- Use ### subheaders for subsections  \n- Use bullet points (- item) for lists\n- Use numbered lists (1. item) for sequential steps\n- Use \"code\" formatting for technical terms\n- Structure the rationale with clear sections and hierarchy\n\nONLY output the JSON object—no other text.\n`;\n\nreturn {\n  json: {\n    systemPrompt,\n    userPrompt,\n  },\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1024,
        5104
      ],
      "id": "ec0e7e9a-cdba-46ec-bbf4-d751418ede26",
      "name": "Code"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-5-20250929",
          "mode": "list",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -816,
        5392
      ],
      "id": "a21d6800-704d-4fc1-898a-9345f2a9dad7",
      "name": "Anthropic Chat Model",
      "credentials": {
        "anthropicApi": {
          "id": "qzCm5Ds2qD9ZY1W5",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are analyzing two sets of extracted software project requirements from an RFP.\n\n{{ $('Downstream LLM Output - FN').item.json.featureListSnippet }}\n\n{{ $json.nfrListSnippet }}\n\nInstructions:\n- Preserve the Functional Requirements exactly as they are.\n- From the Non-Functional list, remove any item that overlaps in meaning with the Functional list.\n- Deduplicate by meaning, not exact wording.\n- Reclassify each item as either:\n  - \"Functional\"\n  - \"Non-Functional\"\n\nDo not include commentary, markdown, or headings — return only the raw JSON.\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are a precise and structured assistant that consolidates software project requirements.\n\nYou will receive two sets of input:\n- Functional Requirements: what the system must do (e.g., user features, system behaviors)\n- Non-Functional Requirements: how the system must behave (e.g., performance, security, usability)\n\nYour task is to:\n- Preserve all Functional Requirements exactly as given.\n- From the Non-Functional Requirements, exclude anything that overlaps with the Functional list (based on intent).\n- Classify each requirement under \"Functional\" or \"Non-Functional\".\n- Ensure phrasing is specific, unambiguous, and clean.\n- Return a single valid JSON object with this structure:\n\nEach item must include:\ntitle: Short summary\ndescription: Specific requirement\n\nDo not omit meaningful content. Do not return explanations."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -3840,
        4480
      ],
      "id": "2c15d026-19a9-4df9-b583-41aa35454185",
      "name": "Combine Requirements",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsonSchemaExample": "[\n  {\n    \"functional\": [\n      {\n        \"title\": \"Short title\",\n        \"description\": \"Detailed and unambiguous requirement\"\n      }\n    ],\n    \"non_functional\": [\n      {\n        \"title\": \"Security Captcha on Admin Login\",\n        \"description\": \"Login to admin panel must include CAPTCHA and CSRF protection.\"\n      }\n    ]\n  }\n]\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -3504,
        4640
      ],
      "id": "7edcae8d-62ad-4747-b73b-b1b6f712ff1c",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function Node — \"Build Combined Requirements Snippet\"\n *\n * Input shape:\n * [\n *   {\n *     output: [\n *       {\n *         functional: [ { title, description }, ... ],\n *         non_functional: [ { title, description }, ... ]\n *       }\n *     ]\n *   }\n * ]\n *\n * Output shape:\n * {\n *   combinedRequirementsSnippet: '### COMBINED_REQUIREMENTS …'\n * }\n */\n\n// --- Grab input safely -----------------------------------------------------\nconst input = $input.first().json.output?.[0] || {};\nconst functional = input.functional || [];\nconst nonFunctional = input.non_functional || [];\n\n// --- Basic validation ------------------------------------------------------\nif (!Array.isArray(functional) || !Array.isArray(nonFunctional)) {\n  throw new Error('Expected arrays for functional and non_functional requirements.');\n}\n\n// --- Build the snippet -----------------------------------------------------\nconst combinedRequirementsSnippet = [\n  '### FUNCTIONAL AND NON-FUNCTIONAL REQUIREMENTS (authoritative, merged functional and non-functional set)',\n  JSON.stringify({ functional, non_functional: nonFunctional }, null, 2),\n  '',\n  'Treat this merged list as the unified scope for all downstream steps including tech stack reasoning, risk estimation, and delivery planning.'\n].join('\\n');\n\n// --- Return for downstream use --------------------------------------------\nreturn [\n  {\n    json: {\n      combinedRequirementsSnippet\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3344,
        4464
      ],
      "id": "881729f1-57b4-41bf-a3fa-1594d30dfcdc",
      "name": "Combined Requirements Output"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2eb926dc-6f8b-4145-a627-2a699038399a",
              "name": "detectedPlatformsSnippet",
              "value": "={{ $('Downstream LLM Output - Platforms').first().json.detectedPlatformsSnippet }}",
              "type": "string"
            },
            {
              "id": "224cb69c-4a9f-4228-a215-25531d77b261",
              "name": "combinedRequirementsSnippet",
              "value": "={{ $json.combinedRequirementsSnippet }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3120,
        4464
      ],
      "id": "8ce9f7ae-8bc3-4d2b-a9f4-d50f5fbbd068",
      "name": "Dependencies1"
    },
    {
      "parameters": {
        "content": "## Combined Requirements\n",
        "height": 548,
        "width": 2932
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4560,
        4368
      ],
      "id": "33a1dbe2-315f-472f-83c3-e7160d8e5742",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"team_plan\": {\n    \"roles\": [\n      { \"role\": \"Product Owner\", \"fte\": 1.0, \"rationale\": \"≤ 200 words explaining the decisions.\" },\n      { \"role\": \"Scrum Master\", \"fte\": 0.5, \"rationale\": \"≤ 200 words explaining the decisions.\" }\n    ],\n    \"rationale\": \"≤ 500 words explaining the decisions.\"\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -496,
        5424
      ],
      "id": "e22eed2c-5d47-4d44-8c1f-bc08253452b2",
      "name": "Team Composition1"
    },
    {
      "parameters": {
        "content": "## Team Compositon\n",
        "height": 508,
        "width": 2948,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1520,
        5056
      ],
      "id": "4885b177-013f-462b-8d74-c9c17bbb3ab9",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node\n * Input  : first item from the previous “Team-Composition” LLM step\n * Output : { teamCompositionSnippet: '### TEAM_COMPOSITION …' }\n */\n\nconst team_plan = $input.first().json.output?.team_plan;\n\nif (!team_plan || typeof team_plan !== 'object') {\n  throw new Error('Expected output.team_plan object from previous step.');\n}\n\nconst teamCompositionSnippet = [\n  '### TEAM_COMPOSITION (authoritative, extracted in a prior step)',\n  JSON.stringify(team_plan, null, 2),\n  '',\n  'Treat this team structure as a baseline for effort, duration, and cost calculations downstream.'\n].join('\\n');\n\nreturn [\n  {\n    json: {\n      teamCompositionSnippet,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -96,
        5104
      ],
      "id": "b94686a9-16d0-436d-b0d4-6ace12c367d6",
      "name": "Team Composition Output"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"min_sprints\": 0,\n\t\"max_sprints\": 0,\n    \"rationale\":\"\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -3632,
        6128
      ],
      "id": "3b2d726c-adf3-4a64-b2a8-e9206e9062f3",
      "name": "Greenfield + Rationale"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -3824,
        6144
      ],
      "id": "f24f3835-b637-4665-9e48-5688e3cae00c",
      "name": "GPT 4.1 Mini4",
      "credentials": {
        "openAiApi": {
          "id": "M8xqWvEC6mH6LNuk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const snippets = [\n  $('Dependencies1').first().json.combinedRequirementsSnippet,\n].join('\\n\\n');\n\nconst techstack = $('Techstack Output1').first().json.detectedTechStackSnippet;\nconst team = $('Team Composition Output').first().json.teamCompositionSnippet;\n\n\nconst systemPrompt = `\nYou are a senior delivery strategist estimating agile effort for software projects.\nYour goal is to output a realistic 2-week sprint range (min to max) based on high-level scope and delivery context.\nAlways assume:\n• Optimal AI-assisted development using modern tooling (AI pair programming, codegen, automated testing)\n• A capable cross-functional team with each developer delivering 15 story points per sprint\n• High delivery velocity without unnecessary padding\nYour output must be a valid JSON object under the key \"sprint_estimate\". Do not include any other text or formatting.\n`;\n\nconst userPrompt = `\nBelow are structured excerpts that describe the project context:\n\n${snippets}\n${team}\n${techstack}\n\nTASK:\n1. Estimate the number of 2-week sprints needed to implement the full scope (MVP).\n2. Return:\n   - \"min_sprints\": lower-bound estimate\n   - \"max_sprints\": upper-bound estimate\n   - \"rationale\": a short explanation (< 700 characters)\n\nESTIMATION RULES:\n• Narrow the sprint range if the scope is well-defined and straightforward.\n• Consider the number of developers, assuming they can work in parallel on the same tech stack or domain area.\n• Use a broader range when there are significant risks (e.g. vague NFRs, unclear integrations, or regulatory complexity).\n• Exclude wide buffers, discovery work, and post-launch support.\n• Only estimate the implementation phase (from kick-off to MVP launch).\n• Do NOT break down or estimate features individually.\n• Output must be in JSON only—no markdown, bullet points, or additional text.\n• The \"rationale\" field must clearly explain how scope, risk, and delivery dynamics affect the sprint estimate.\n\nPROJECT DURATION PRINCIPLE:\nAssume that developers and supporting roles work in parallel across their own domains.  \nHowever, the **total project duration should be anchored to the development stream that carries the most effort** (e.g., frontend-heavy projects should span as long as frontend implementation takes).  \nOther roles (e.g., backend, QA, PM) should be proportional in effort and capacity (FTE), but not dictate overall duration if they finish earlier.  \nDo not artificially serialize tasks, but reflect the true critical path of the most effort-heavy track.\n\n• For projects using a \"Heavily AI Generated\" tech stack, assume high delivery velocity and minimal risk overhead—this should reduce the lower-bound estimate.\n• If the RFP includes a fixed deadline or time budget:\n  - Suggest team composition adjustments (e.g., adding developers) to meet the timeline.\n  - Propose requirement descoping strategies (e.g., removing non-critical, high-risk features) to help fit the scope within constraints.\n  - Use this reasoning to support the “note” field in the JSON output.\n\n  **IMPORTANT: Format the rationale field using markdown markup for better readability:**\n- Use **bold text** for key points and important terms\n- Use ## headers for main sections\n- Use ### subheaders for subsections  \n- Use bullet points (- item) for lists\n- Use numbered lists (1. item) for sequential steps\n- Use \"code\" formatting for technical terms\n- Structure the rationale with clear sections and hierarchy\n`;\n\nreturn {\n  json: {\n    systemPrompt,\n    userPrompt\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4160,
        5904
      ],
      "id": "e015972d-b083-4c48-a273-e4bc30438fa7",
      "name": "Code2"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-5-20250929",
          "mode": "list",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {
          "maxTokensToSample": 6000,
          "temperature": 0.1,
          "thinking": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -3968,
        6144
      ],
      "id": "560a88bd-9d57-438f-b3e0-a8b9ec979238",
      "name": "Anthropic Chat Model2",
      "credentials": {
        "anthropicApi": {
          "id": "qzCm5Ds2qD9ZY1W5",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Effort Estimation\n",
        "height": 740,
        "width": 2000,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4576,
        5824
      ],
      "id": "edcda6e4-a82c-41c5-8e4b-8065dc361473",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -3872,
        5904
      ],
      "id": "4c7a6469-ec95-46ca-a32f-4c11491bcfb3",
      "name": "Effort Estimation",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -3728,
        6144
      ],
      "id": "770b1b2c-60a2-4b09-9ba3-770605b2845d",
      "name": "Calculator"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"phases\": [\n    {\n      \"name\": \"Planning and Foundation\",\n      \"sprints\": { \"start\": 1, \"end\": 2 },\n      \"items\": [\n        \"Set up environments and CI/CD pipeline\",\n        \"Define architecture and technical frameworks\",\n        \"Implement user authentication and role system\"\n      ]\n    },\n    {\n      \"name\": \"Core Development\",\n      \"sprints\": { \"start\": 3, \"end\": 6 },\n      \"items\": [\n        \"Develop mission system and rewards engine\",\n        \"Integrate forest visualization and topic feed\"\n      ]\n    }\n  ],\n  \"cross_cutting\": {\n    \"infrastructure\": [ \"CI/CD setup\", \"VPN access configuration\" ],\n    \"security\": [ \"Access control\", \"Penetration testing\" ],\n    \"testing\": [ \"Unit testing\", \"UAT\" ],\n    \"documentation\": [ \"API documentation\", \"User guides\" ],\n    \"deployment\": [ \"Staging environment\", \"Production rollout\" ]\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -1664,
        6240
      ],
      "id": "6a2a504b-4c62-4cf5-afe4-e93cf328c6e6",
      "name": "Greenfield + Rationale3"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1904,
        6240
      ],
      "id": "9affadcd-05bb-4234-a44f-dd66a304bee3",
      "name": "GPT 4.1 Mini5",
      "credentials": {
        "openAiApi": {
          "id": "M8xqWvEC6mH6LNuk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const snippets = [\n  $('Dependencies1').first().json.combinedRequirementsSnippet,\n].join('\\n\\n');\n\nconst team = $('Team Composition Output').first().json.teamCompositionSnippet;\nconst estimation = $('Effort Estimate Output').first().json.effortEstimationSnippet;\n\nconst systemPrompt = `\nYou are a senior technical project planner and agile delivery strategist. You design high-level sprint-based development plans for software projects based on known scope and estimated duration.\nYou always:\n- Organize the plan into clear sprint phases\n- Include key delivery activities per phase\n- Address cross-cutting themes like infrastructure, testing, and security\n- Avoid repeating or re-estimating effort\n`;\n\nconst userPrompt = `\nBelow are structured excerpts that describe the project context:\n\n${snippets}\n${team}\n${estimation}\n\nYour task:\n- Do not include discovery phase\n- Take into consideration the optimal AI Assisted Development and setup for that\n- Consider the number of developers, assuming they can work in parallel on the same tech stack or domain area.\n- Use the \"min_sprints\" and \"max_sprints\" from the effort estimation as the timeline range.\n- Assume Agile 2-week sprints.\n1. Create a high-level **sprint-based development plan** that aligns with the estimated duration.\n2. Organize the plan into **semantically labeled phases** based on common delivery flow, such as:\n   - \"Setup and Foundation\"\n   - \"Core Development\"\n   - \"Feature Completion and Polishing\"\n   - \"Finalization and Handover\"\n3. For each phase, include:\n   - A \"name\" (semantic label as described)\n   - A \"sprints\" object with \"start\" and \"end\" sprint numbers\n   - A list of \"items\" representing deliverables, feature groups, or technical milestones\n\n4. Also provide a \"cross_cutting\" section with grouped items under:\n   - \"infrastructure\"\n   - \"security\"\n   - \"testing\"\n   - \"documentation\"\n   - \"deployment\"\nAvoid generic items. Make cross-cutting work as concrete and contextualized as possible (e.g. “Configure Firebase Analytics for event tracking” under analytics).\nYou must not re-estimate effort. Use the sprint range provided.\n\n`;\n\nreturn {\n  json: {\n    systemPrompt,\n    userPrompt\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2192,
        6016
      ],
      "id": "e0c481d4-785c-4ccd-81a8-f5d07e4215d2",
      "name": "Code3"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-5-20250929",
          "mode": "list",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {
          "maxTokensToSample": 8000,
          "temperature": 0.3,
          "thinking": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -2032,
        6240
      ],
      "id": "ed1638a5-af77-453c-9cde-c0d4b8e39a1a",
      "name": "Anthropic Chat Model3",
      "credentials": {
        "anthropicApi": {
          "id": "qzCm5Ds2qD9ZY1W5",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Development Plan\n",
        "height": 740,
        "width": 1340,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2224,
        5792
      ],
      "id": "5e5393d0-addc-4fbe-a865-69016fca949d",
      "name": "Sticky Note14"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -1792,
        6240
      ],
      "id": "5d852782-bd29-4574-a350-2f9140b2a2ca",
      "name": "Calculator1"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node\n * Input  : first item from the previous “Effort Estimation” LLM step\n * Output : { effortEstimationSnippet: '### EFFORT_ESTIMATION …' }\n */\n\nconst effort = $input.first().json.output;\n\nif (!effort || typeof effort !== 'object') {\n  throw new Error('Expected output object with min_sprints, max_sprints, rationale, and discovery_steps.');\n}\n\nconst effortEstimationSnippet = [\n  '### EFFORT_ESTIMATION (authoritative, generated in prior step)',\n  JSON.stringify(effort, null, 2),\n  '',\n  'Treat this sprint range and rationale as the base reference for downstream cost, buffer, and delivery planning.'\n].join('\\n');\n\nreturn [\n  {\n    json: {\n      effortEstimationSnippet,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3424,
        5904
      ],
      "id": "bb1103d9-c0fb-48a1-8f55-9461740c679b",
      "name": "Effort Estimate Output"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -1968,
        5968
      ],
      "id": "3080411c-1f83-47c9-87bc-03e8a2ba2d03",
      "name": "Development Plan",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const snippets = [\n  $('Dependencies').first().json.regulatoryComplianceSnippet,\n  $('Dependencies').first().json.combinedRequirementsSnippet,\n  $('Dependencies').first().json.projectClassificationSnippet,\n  $('Dependencies').first().json.deliveryRequirementsSnippet,\n  $('Dependencies').first().json.detectedTechStackSnippet,\n  $('Dependencies').first().json.teamCompositionSnippet,\n  $input.first().json.riskRegisterSnippet\n].join('\\n\\n');\n\nconst systemPrompt = `\nYou are a senior delivery strategist estimating agile effort for software projects.\nYour goal is to output a realistic 2-week sprint range (min to max) based on high-level scope and delivery context.\nAlways assume:\n• Optimal AI-assisted development using modern tooling (AI pair programming, codegen, automated testing)\n• A capable cross-functional team with each developer delivering 15 story points per sprint\n• High delivery velocity without unnecessary padding\nYour output must be a valid JSON object under the key \"sprint_estimate\". Do not include any other text or formatting.\n`;\n\nconst userPrompt = `\nBelow are structured excerpts that describe the project context:\n\n${snippets}\n\nTASK:\n1. Estimate the number of 2-week sprints needed to implement the full scope (MVP).\n2. Return:\n   - \"min_sprints\": lower-bound estimate\n   - \"max_sprints\": upper-bound estimate\n   - \"rationale\": a short explanation < 700 characters\n   - \"discovery steps\": steps that should be done in discovery to mitigate risks and reduce the buffer\n\nESTIMATION RULES:\nDiscovery is excluded from the sprint count, but provide discovery steps to reduce uncertainty\n• Narrow the sprint range if the scope is well-defined and straightforward.\n• Consider the number of developers, assuming they can work in parallel on the same tech stack or domain area.\n• Use a broader range when there are significant risks (e.g. vague NFRs, unclear integrations, or regulatory complexity).\n• Exclude wide buffers, discovery work, and post-launch support.\n• Only estimate the implementation phase (from kick-off to MVP launch).\n• Do NOT break down or estimate features individually.\n• Output must be in JSON only—no markdown, bullet points, or additional text.\n• The \"rationale\" field must clearly explain how scope, risk, and delivery dynamics affect the sprint estimate.\n• Anchor the timeline to the developer role bearing the most implementation load (e.g., frontend-heavy projects should reflect frontend effort primarily, with others scaled accordingly).\n• For projects using a \"Heavily AI Generated\" tech stack, assume high delivery velocity and minimal risk overhead—this should reduce the lower-bound estimate.\n• If the RFP includes a fixed deadline or time budget:\n  - Suggest team composition adjustments (e.g., adding developers) to meet the timeline.\n  - Propose requirement descoping strategies (e.g., removing non-critical, high-risk features) to help fit the scope within constraints.\n  - Use this reasoning to support the “note” field in the JSON output.\n`;\n\nreturn {\n  json: {\n    systemPrompt,\n    userPrompt\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4160,
        6064
      ],
      "id": "40c4d7c4-5a88-4659-bdeb-ec668b76b300",
      "name": "Code4"
    },
    {
      "parameters": {
        "formTitle": "RFP",
        "formFields": {
          "values": [
            {
              "fieldLabel": "file",
              "fieldType": "file",
              "multipleFiles": false,
              "acceptFileTypes": ".pdf"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [
        -3936,
        1840
      ],
      "id": "4f6ae0ea-fb59-4d45-b544-48dd6d19f601",
      "name": "RFP Upload",
      "webhookId": "8d2e96c1-7cf3-403f-928e-1311dd82e25c",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "rfp-analyse",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4640,
        2544
      ],
      "id": "691bc49a-6999-4093-b5b5-e4d00d71e71f",
      "name": "Start RFP Analysis",
      "webhookId": "53a86925-cd35-4e6c-803f-c3447b7fa011"
    },
    {
      "parameters": {
        "jsCode": "// Get the output from the Combined Requirements Output node\nconst combinedOutput = $('Combine Requirements').first().json.output;\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\n// Extract only titles from both functional and non-functional requirements\nconst titlesOnly = combinedOutput.map(section => {\n  const processedSection = {};\n  \n  // Process each category (functional, non-functional, etc.)\n  Object.keys(section).forEach(category => {\n    if (Array.isArray(section[category])) {\n      processedSection[category] = section[category].map(req => req.title);\n    }\n  });\n  \n  return processedSection;\n});\n\nconst payload = {\n  step: \"requirements\",\n  title: \"Step 3. Requirements\",\n  sessionId: sessionId,\n  output: JSON.stringify(titlesOnly)\n};\n\nreturn [{\n  json: payload\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2912,
        4464
      ],
      "id": "882dff30-150d-473c-b2e7-30f077421ce2",
      "name": "Prepare for frontend9"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sse-estimation-tool.onrender.com/progress",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ $json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2704,
        4464
      ],
      "id": "f9faa267-bc27-4e32-9491-f5c166722c52",
      "name": "SSE - Requirements"
    },
    {
      "parameters": {
        "jsCode": "// Get the output from the Combined Requirements Output node\nconst team = $('Team Composition').first().json.output;\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\nconst payload = {\n  step: \"team_composition\",\n  title: \"Step 5. Team Composition\",\n  sessionId: sessionId,\n  output: JSON.stringify(team)\n};\n\nreturn [{\n  json: payload\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        160,
        5104
      ],
      "id": "5c147139-2666-4f15-b234-92aa6471de5c",
      "name": "Prepare for frontend11"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sse-estimation-tool.onrender.com/progress",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ $json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        432,
        5104
      ],
      "id": "163b7336-e943-454d-b930-ad5867e5cc06",
      "name": "SSE - Team Composition"
    },
    {
      "parameters": {
        "jsCode": "// Get the output from the Combined Requirements Output node\nconst effort = $('Effort Estimation').first().json.output;\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\nconst payload = {\n  step: \"effort_estimation\",\n  title: \"Step 6. Effort Estimation\",\n  sessionId: sessionId,\n  output: JSON.stringify(effort)\n};\n\nreturn [{\n  json: payload\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3184,
        5904
      ],
      "id": "4b09d9c9-d4db-4685-a9d0-714ee665eda8",
      "name": "Prepare for frontend12"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sse-estimation-tool.onrender.com/progress",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ $json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2944,
        5888
      ],
      "id": "c40834f3-ebc0-465e-9800-9a91bc4f90c3",
      "name": "SSE - Effort Estimation"
    },
    {
      "parameters": {
        "jsCode": "// Get the output from the Combined Requirements Output node\nconst plan = $('Development Plan').first().json.output;\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\nconst payload = {\n  step: \"development_plan\",\n  title: \"Step 7. Development Plan\",\n  sessionId: sessionId,\n  output: JSON.stringify(plan)\n};\n\nreturn [{\n  json: payload\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1328,
        5968
      ],
      "id": "cf1b0002-3df2-4ac2-b03e-e466e37c20d2",
      "name": "Prepare for frontend13"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sse-estimation-tool.onrender.com/progress",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ $json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1104,
        5968
      ],
      "id": "69e4c7f7-28ed-4bc0-be82-004784d5ed3e",
      "name": "SSE - Development Plan"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-20250514",
          "mode": "list",
          "cachedResultName": "Claude Sonnet 4"
        },
        "options": {
          "maxTokensToSample": 6096,
          "thinking": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -528,
        6176
      ],
      "id": "d9955ba4-0888-4631-9e45-c3eb65f33308",
      "name": "Anthropic Chat Model5",
      "credentials": {
        "anthropicApi": {
          "id": "qzCm5Ds2qD9ZY1W5",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        -528,
        6000
      ],
      "id": "8ee17632-4c49-4397-9dd8-3ae771f0f2b0",
      "name": "Reporter",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.output;\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\nconst payload = {\n  step: \"final_report\",\n  title: \"Step 8. Final Report\",\n  sessionId: sessionId,\n  output: input\n};\n\nreturn [{\n  json: payload\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -128,
        6000
      ],
      "id": "15034702-73a6-45fb-bc2c-d6b20dc2f0ab",
      "name": "Prepare for frontend7"
    },
    {
      "parameters": {
        "jsCode": "\n//const requirements = $('Dependencies1').first().json.combinedRequirementsSnippet;\nconst team = $('Team Composition Output').first().json.teamCompositionSnippet;\nconst estimation = $('Effort Estimate Output').first().json.effortEstimationSnippet;\nconst dev = $('Development Plan Output').first().json.developmentPlanOutput;\nconst techstack = $('Techstack Output1').first().json.detectedTechStackSnippet\nconst platforms = $('Downstream LLM Output - Platforms').first().json.detectedPlatformsSnippet\n\nconst systemPrompt = `\nYou are a professional document formatter specialized in creating executive-grade PDF reports. Your role is to take structured project data and present it in a clean, professional format optimized for PDF rendering.\n\nCRITICAL REQUIREMENTS:\n- Present existing data in professional PDF format - DO NOT add new analysis\n- Use clean markdown formatting with proper line breaks\n- Format existing information into professional tables and sections\n- Use executive summary styling and highlight boxes for key information\n- Keep content high-level and focused on presenting the provided data clearly\n`;\n\nconst userPrompt = `\nFormat the provided project analysis data into a professional executive summary document optimized for PDF export.\n\nFORMATTING REQUIREMENTS:\n- Use proper markdown syntax (not escaped characters)\n- Present data in professional tables and sections\n- Use **RECOMMENDATION**, **RISK**, **SUCCESS** for any existing insights\n- Structure with clear headers using # ## ### syntax\n- Include executive summary with key metrics from provided data\n\n**DATA TO FORMAT:**\n\n**PLATFORMS:** ${platforms}\n**TECHNOLOGY STACK:** ${techstack}  \n**TEAM COMPOSITION:** ${team}\n**EFFORT ESTIMATION:** ${estimation}\n**DEVELOPMENT PLAN:** ${dev}\n\nGenerate a professional document with this structure:\n\n# PROJECT DELIVERY SUMMARY\n## [Extract project name/type from data]\n\n<div class=\"executive-summary\">\n\n**PROJECT INVESTMENT SUMMARY**\n\n[Create 150-200 word summary using ONLY the provided data, highlighting:\n- Platform scope (from platforms data)\n- Technology approach (from techstack data) \n- Team size and timeline (from team/estimation data)\n- Key deliverables (from dev plan data)]\n\n**Key Investment Metrics:**\n- **Timeline:** [Extract from estimation data] sprints ([calculate weeks])\n- **Team Size:** [Sum FTE from team data] FTE resources\n- **Platforms:** [List from platforms data]\n- **Technology Stack:** [Summary from techstack data]\n\n</div>\n\n## Platform and Technology Overview\n\n### Target Platforms\n[Create table from platforms data showing platform types and descriptions]\n\n### Technology Architecture  \n[Format techstack data into clear sections:\n- Backend: [from backend_stack]\n- Frontend: [from web_stack] \n- Mobile: [from mobile_stack]\n- Database: [from database]\n- Deployment: [from deployment]\n- Key Integrations: [from integrations]]\n\n## Team Structure and Resource Allocation\n\n[Create professional table from team data with columns:]\n| **Role** | **FTE Allocation** | **Key Responsibilities** |\n|----------|-------------------|--------------------------|\n[Format each role from team composition data]\n| **Total Team** | **[Sum all FTE]** | **Complete project delivery** |\n\n## Development Timeline and Phases\n\n### Project Timeline\n- **Sprint Range:** [min_sprints] - [max_sprints] sprints\n- **Estimated Duration:** [calculate weeks/months from sprint data]\n- **Methodology:** Agile with 2-week sprints\n\n### Development Phases\n[For each phase in development plan, create structured overview:]\n\n**Phase [X]: [phase name]** (Sprints [start]-[end])\n- **Duration:** [calculate sprint count] sprints  \n- **Key Focus:** [summarize 2-3 main items from phase items]\n\n[Continue for all phases in dev plan...]\n\n\n## Executive Summary\n\n<div class=\"highlight-box\">\n\n**PROJECT DELIVERY OVERVIEW**\n\n**Total Investment:** [Sum team FTE] FTE resources over [estimation range] sprints\n\n**Technology Approach:** [Brief summary of separated/unified architecture from techstack]\n\n**Delivery Confidence:** Based on [estimation rationale summary]\n\n**Key Success Factors:**\n- [Extract 2-3 points from team/estimation rationale]\n\n\n</div>\n\nIMPORTANT INSTRUCTIONS:\n- Use ONLY the data provided - do not add new analysis or conclusions\n- Format existing information into professional presentation\n- Keep requirements section as overview/summary only (do not list all requirements)\n- Present data clearly without adding interpretation beyond what's already provided\n- Use professional formatting that works well with PDF generation\n`;\n\nreturn {\n  json: {\n    systemPrompt,\n    userPrompt\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -752,
        5968
      ],
      "id": "e89edf38-d3db-4045-8cb3-577165842ae8",
      "name": "Prompt"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node\n * Input  : first item from the previous “Effort Estimation” LLM step\n * Output : { effortEstimationSnippet: '### EFFORT_ESTIMATION …' }\n */\n\nconst effort = $input.first().json.output;\n\nif (!effort || typeof effort !== 'object') {\n  throw new Error('Expected output object with development plan.');\n}\n\nconst developmentPlanOutput = [\n  '### DEVELOPMENT_PLAN (authoritative, generated in prior step)',\n  JSON.stringify(effort, null, 2),\n  '',\n  'Treat this development plan as the base reference.'\n].join('\\n');\n\nreturn [\n  {\n    json: {\n      developmentPlanOutput,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1520,
        5968
      ],
      "id": "e51311bc-f227-4f0e-aee6-df2476a71e9f",
      "name": "Development Plan Output"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -272,
        6208
      ],
      "id": "a86b7528-d2a0-42d3-9e54-d5acdd88a3e6",
      "name": "Calculator2"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        -368,
        6208
      ],
      "id": "cbff966a-71cb-4f47-9745-b87accc7bf9a",
      "name": "Think2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sse-estimation-tool.onrender.com/progress",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        128,
        6000
      ],
      "id": "a03f80ae-3207-4f63-9a74-7fcdfb5d7e51",
      "name": "SSE - Final Report"
    },
    {
      "parameters": {
        "jsCode": "// Get sessionId from previous step\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\n// Professional PDF content example\nconst professionalContent = `# PROJECT2 DELIVERY SUMMARY\n## Enterprise CRM & Customer Management Platform\n\n<div class=\"executive-summary\">\n\n**PROJECT INVESTMENT SUMMARY**\n\nThis comprehensive enterprise CRM platform represents a strategic digital transformation initiative requiring 18-24 months and 12.5 FTE resources. The solution encompasses web applications, mobile platforms (iOS/Android), and robust backend services with extensive third-party integrations including Microsoft 365, Salesforce, and QuickBooks Online.\n\nThe project scope includes 45 functional requirements spanning user management, advanced analytics, customer journey mapping, automated marketing workflows, and comprehensive reporting capabilities. Additionally, 28 non-functional requirements mandate enterprise-grade security, GDPR compliance, scalability to support 1000+ concurrent users, and 99.9% uptime SLA.\n\n**Key Investment Metrics:**\n- **Estimated Timeline:** 18-24 months\n- **Required Team Size:** 12.5 FTE resources  \n- **Total Investment:** 300-450 person-months\n- **Confidence Level:** High (88%)\n- **Overall Risk Level:** Medium\n\n**Strategic Recommendation:** Proceed with phased implementation approach to minimize risk and deliver incremental business value.\n\n</div>\n\n## Project Scope and Requirements Analysis\n\n**Project Complexity Rating:** Highly Complex\n\nThe comprehensive requirements analysis reveals a sophisticated enterprise-level platform with multiple integration points and advanced functionality requirements.\n\n### Requirements Quality Assessment\n\n- **Completeness Rating:** Excellent (92%) - Well-defined functional and technical specifications\n- **Technical Clarity:** High - Clear architectural requirements and integration specifications  \n- **Implementation Feasibility:** High - Technically achievable with recommended team structure\n\n**RECOMMENDATION**: Requirements are well-defined and ready for implementation. Recommend conducting technical discovery workshops for Microsoft 365 and Salesforce integration specifics.\n\n**RISK**: Complex third-party integrations may introduce timeline dependencies on external vendor support and API limitations.\n\n## Investment Analysis and Resource Planning\n\n### Development Effort Estimation\n\n| **Investment Metric** | **Minimum Scenario** | **Most Likely** | **Maximum Scenario** | **Recommended Planning** |\n|----------------------|---------------------|-----------------|---------------------|-------------------------|\n| **Development Duration** | 16 months | 20 months | 24 months | 20 months |\n| **Sprint Count** | 32 sprints | 40 sprints | 48 sprints | 40 sprints |\n| **Team Size (FTE)** | 10.0 FTE | 12.5 FTE | 15.0 FTE | 12.5 FTE |\n| **Confidence Level** | 75% | 88% | 95% | 88% |\n| **Total Investment** | 267 person-months | 333 person-months | 450 person-months | 333 person-months |\n\n### Timeline and Risk Analysis\n\n**Estimation Methodology:** Three-point estimation using industry benchmarks for enterprise CRM implementations, adjusted for project complexity and team experience.\n\n**Critical Timeline Factors:**\n- Third-party API integration complexity and documentation quality\n- Customer data migration from legacy systems (estimated 2.5M records)\n- Enterprise security compliance and penetration testing requirements\n- User acceptance testing across multiple business units (250+ users)\n\n**RISK**: Microsoft 365 integration timeline dependent on tenant configuration complexity and may require additional 2-4 weeks if custom permissions are needed.\n\n**SUCCESS**: Strong technical leadership availability and clear business requirements will accelerate development velocity by an estimated 15-20%.\n\n## Team Composition and Resource Strategy\n\n### Recommended Team Structure\n\n| **Role** | **FTE Allocation** | **Duration (months)** | **Key Responsibilities** | **Seniority Required** |\n|----------|-------------------|-----------------------|-------------------------|----------------------|\n| **Technical Lead** | 1.0 FTE | 20 months | Architecture, code reviews, technical decisions | Senior (8+ years) |\n| **Backend Developers** | 3.0 FTE | 18 months | API development, database design, integrations | Mid-Senior (5+ years) |\n| **Frontend Developers** | 2.5 FTE | 16 months | React web app, responsive design, UX implementation | Mid-Level (3+ years) |\n| **Mobile Developers** | 2.0 FTE | 14 months | iOS/Android native apps, mobile UX optimization | Mid-Senior (4+ years) |\n| **DevOps Engineer** | 1.0 FTE | 20 months | CI/CD, infrastructure, monitoring, security | Senior (6+ years) |\n| **QA Engineers** | 2.0 FTE | 18 months | Test automation, manual testing, UAT coordination | Mid-Level (3+ years) |\n| **UI/UX Designer** | 1.0 FTE | 12 months | Design system, prototypes, user research | Mid-Senior (4+ years) |\n| **Total Team** | **12.5 FTE** | **20 months** | **Complete enterprise platform delivery** | **Mixed experience levels** |\n\n### Resource Strategy\n\n**Team Composition Rationale:** Balanced team structure emphasizing backend expertise for complex integrations while ensuring strong frontend capabilities for user experience excellence.\n\n**Critical Skills and Expertise:**\n- Microsoft 365 API integration experience (Graph API, SharePoint)\n- Enterprise security implementation (OAuth 2.0, SAML, encryption)\n- High-volume data processing and optimization\n- Mobile application development with offline capabilities\n\n**RECOMMENDATION**: Prioritize hiring technical lead and senior backend developers first to establish architecture foundation. Consider Microsoft-certified developers for Graph API integration.\n\n**SUCCESS**: Cross-functional team with previous enterprise CRM experience will reduce learning curve and improve delivery predictability by 25-30%.\n\n## Development Methodology and Delivery Phases\n\n### Development Approach\n\nAgile methodology with 2-week sprints, emphasizing continuous integration, automated testing, and regular stakeholder feedback loops. Parallel development tracks for web, mobile, and backend components with clearly defined integration milestones.\n\n### Delivery Phase Breakdown\n\n**Phase 1: Foundation & Core Platform** (Sprints 1-12)\n- **Duration:** 12 sprints (24 weeks)\n- **Key Deliverables:** \n  - Core authentication and user management system\n  - Basic CRM functionality (contacts, accounts, opportunities)\n  - Database schema and API foundation\n  - Development infrastructure and CI/CD pipeline\n- **Success Criteria:** User authentication, basic CRUD operations, automated testing framework\n- **Dependencies:** Infrastructure setup, third-party service accounts provisioning\n\n**Phase 2: Advanced Features & Integrations** (Sprints 13-28)\n- **Duration:** 16 sprints (32 weeks)\n- **Key Deliverables:** \n  - Microsoft 365 integration (Calendar, Email, SharePoint)\n  - Advanced analytics and reporting engine\n  - Mobile applications (iOS and Android)\n  - Automated workflow engine\n- **Success Criteria:** Full integration functionality, mobile app store deployment, analytics dashboard\n- **Dependencies:** Microsoft 365 tenant configuration, mobile developer account setup\n\n**Phase 3: Enterprise Features & Optimization** (Sprints 29-40)\n- **Duration:** 12 sprints (24 weeks)\n- **Key Deliverables:** \n  - Advanced security features and compliance\n  - Performance optimization and scalability testing\n  - Data migration tools and legacy system integration\n  - User training materials and documentation\n- **Success Criteria:** Security certification, performance benchmarks met, successful data migration\n- **Dependencies:** Legacy system access, security audit scheduling\n\n### Project Success Framework\n\n**SUCCESS**: Key factors ensuring project success include dedicated product owner engagement, regular stakeholder reviews, and phased user acceptance testing with business units.\n\n**RISK**: Primary project risks include third-party API changes, scope creep from additional integration requests, and resource availability during peak development phases. Mitigation includes API versioning strategy, formal change control process, and backup resource planning.\n\n## Executive Summary and Investment Recommendation\n\n<div class=\"highlight-box\">\n\n**FINAL INVESTMENT RECOMMENDATION**\n\n**Total Project Investment:** 333 person-months over 20 months\n\n**Strategic Recommendation:** **PROCEED** with phased implementation approach\n\n**Confidence Assessment:** High confidence (88%) in delivery estimates based on detailed technical analysis and industry benchmarks\n\n**Critical Success Dependencies:**\n- Dedicated technical leadership and senior backend development expertise\n- Early Microsoft 365 integration planning and tenant configuration\n- Committed product owner with decision-making authority for requirement clarifications\n- Phased user acceptance testing approach with business unit representatives\n\n**Immediate Next Steps:**\n1. **Technical Discovery Phase** (2-4 weeks) - Microsoft 365 integration assessment and architecture design\n2. **Team Assembly** (4-6 weeks) - Recruit technical lead and core backend development team\n3. **Infrastructure Setup** (2-3 weeks) - Development environment, CI/CD pipeline, and monitoring tools\n\n**ROI Projection:** Expected 300% ROI within 18 months post-deployment through improved sales efficiency, automated workflows, and enhanced customer insights.\n\n</div>\n\n**RECOMMENDATION**: This enterprise CRM platform represents a strategic investment with clear business value and technical feasibility. The phased approach minimizes risk while delivering incremental value. Recommend proceeding with immediate technical discovery and team assembly.\n\n## Risk Assessment and Mitigation Strategy\n\n**RISK**: **Third-Party Integration Complexity** - Microsoft 365 and Salesforce API limitations may impact timeline\n- *Mitigation:* Conduct technical proof-of-concept during discovery phase\n- *Contingency:* 2-week buffer built into Phase 2 timeline\n\n**RISK**: **Team Scaling Challenges** - Difficulty finding experienced enterprise developers\n- *Mitigation:* Engage technical recruiting partner, consider remote team members\n- *Contingency:* Adjust timeline by 10-15% if key positions remain unfilled after 6 weeks\n\n**SUCCESS**: **Strong Business Sponsorship** - Executive commitment ensures resource availability and decision-making speed\n- *Advantage:* Reduces requirement clarification delays, accelerates UAT cycles\n- *Impact:* Potential 15-20% timeline improvement with dedicated product ownership\n\nThis comprehensive analysis demonstrates high confidence in successful delivery of an enterprise-grade CRM platform that will transform customer relationship management capabilities and drive significant business value.`;\n\nconst payload = {\n  step: \"final_report\",\n  title: \"Step 8. Final Report\",\n  sessionId: sessionId,\n  output: professionalContent\n};\n\nreturn [{\n  json: payload\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -752,
        6192
      ],
      "id": "b85f7026-7f84-4a5c-877a-8171cd90573d",
      "name": "mock"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "73318e8c-f4bc-4e3b-a732-e31e03228072",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4512,
        7936
      ],
      "id": "af35c458-1167-4214-972f-b692f56bf4e9",
      "name": "Send PDF to Email",
      "webhookId": "73318e8c-f4bc-4e3b-a732-e31e03228072"
    },
    {
      "parameters": {
        "sendTo": "={{ $json.email }}",
        "subject": "=Your Q AI RFP Analysis Report is Ready for {{ $json.body.fileName }}",
        "message": "=<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\" />\n    <title>Q AI RFP Analysis Report</title>\n  </head>\n  <body style=\"font-family: Arial, sans-serif; background-color: #f5f5f5; padding: 20px; margin: 0;\">\n    <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"max-width: 600px; margin: auto; background-color: #ffffff; border-radius: 8px; overflow: hidden;\">\n      <tr>\n        <td style=\"padding: 30px 40px;\">\n          <h2 style=\"color: #333333;\">Dear {{ $json.name }},</h2>\n          <p style=\"font-size: 16px; color: #555555; line-height: 1.6;\">\n            Thank you for using the <strong>Q AI RFP Analysis Tool</strong>.\n          </p>\n          <p style=\"font-size: 16px; color: #555555; line-height: 1.6;\">\n            Attached to this email, you will find the informative analysis report generated based on the RFP you uploaded.\n            The report includes insights related to <strong>estimated effort</strong>, <strong>key requirements</strong>, <strong>potential risks</strong>, and other relevant aspects of the document.\n          </p>\n          <p style=\"font-size: 16px; color: #555555; line-height: 1.6;\">\n            We hope this helps you streamline your decision-making process and improve planning efficiency.\n          </p>\n          <p style=\"font-size: 16px; color: #555555; line-height: 1.6;\">\n            <strong>Please note:</strong> This report was generated using the <strong>limited free version</strong> of our Q Estimation Tool.\n          </p>\n          <p style=\"font-size: 16px; color: #555555; line-height: 1.6;\">\n            To explore the full range of features, visit <a href=\"https://q.agency/products/q-estimation-tool/\" style=\"color: #1a73e8; text-decoration: none;\"><strong>Q Estimation Tool</strong></a>.\n          </p>\n          <p style=\"font-size: 16px; color: #555555; line-height: 1.6;\">\n            If you have any questions or would like further support, feel free to reach us at <a href=\"mailto:hello@q.agency\" style=\"color: #1a73e8; text-decoration: none;\"><strong>hello@q.agency</strong></a>.\n          </p>\n          <p style=\"font-size: 16px; color: #333333; margin-top: 30px;\">\n            Best regards,<br/>\n            <strong>AI Team at Q Agency</strong>\n          </p>\n        </td>\n      </tr>\n      <tr>\n        <td style=\"background-color: #eeeeee; padding: 20px; text-align: center; font-size: 12px; color: #888888;\">\n          © 2025 Q Agency. All rights reserved.\n        </td>\n      </tr>\n    </table>\n  </body>\n</html>",
        "options": {
          "appendAttribution": false,
          "attachmentsUi": {
            "attachmentsBinary": [
              {
                "property": "pdf"
              }
            ]
          },
          "bccList": "zlatko.matokanovic@q.agency"
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3792,
        7936
      ],
      "id": "76fe4683-5e39-4097-9786-0e72d1bc5d9c",
      "name": "Gmail",
      "webhookId": "e293276b-b396-40f8-8ff8-b1e569053fab",
      "credentials": {
        "gmailOAuth2": {
          "id": "AnMIdKkQ5ToxkLrh",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        -4048,
        7936
      ],
      "id": "c972f423-9b65-428d-93fd-7f6ad2b2a1b6",
      "name": "Merge"
    },
    {
      "parameters": {
        "jsCode": "function extractNameFromEmail(email) {\n  if (!email || typeof email !== 'string') return '';\n\n  const localPart = email.split('@')[0];\n\n  // Replace separators with spaces\n  const raw = localPart.replace(/[\\._\\-]+/g, ' ').trim();\n\n  // Split and capitalize\n  const nameParts = raw\n    .split(' ')\n    .filter(Boolean)\n    .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase());\n\n  return nameParts.join(' ');\n}\n\nconst input = $input.first().json;\n\nconst email = input.body?.email || '';\nconst sessionId = input.body?.sessionId || '';\nconst name = extractNameFromEmail(email);\nconst fileName = $input.first().json.body.originalFilename\n\n\nreturn [\n  {\n    json: {\n      email,\n      name,\n      sessionId,\n      fileName,\n      binary: input.binary\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4272,
        8064
      ],
      "id": "4c71e8e9-a39b-47c8-aa91-1fe6d48883a7",
      "name": "Code6"
    },
    {
      "parameters": {
        "content": "## Email Trigger - Client\n",
        "height": 860,
        "width": 1320,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4592,
        7696
      ],
      "id": "c96078ab-71aa-44ed-a3c2-e736655cdd48",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## Final Report\n",
        "height": 520,
        "width": 1080
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -784,
        5888
      ],
      "id": "df154def-6577-4f41-9873-974fa2c8e4cd",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "errorType": "errorObject",
        "errorObject": "{\n  \"title\": \"Functional Requirements\",\n  \"message\": \"Unfortunately, we couldn’t identify the functional requirements from your RFP. Since this information is essential for the analysis, the process has been halted.\"\n}"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -3504,
        4224
      ],
      "id": "3450203e-6705-42a9-a1e9-9d1a73cf535a",
      "name": "Stop and Error3"
    },
    {
      "parameters": {
        "errorType": "errorObject",
        "errorObject": "{\n  \"title\": \"Team Composition\",\n  \"message\": \"Unfortunately, we couldn’t identify the team composition from your RFP. Since this information is essential for the analysis, the process has been halted.\"\n}"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -384,
        5216
      ],
      "id": "e458cef9-e401-49d5-a62c-07e123bb10d0",
      "name": "Stop and Error5"
    },
    {
      "parameters": {
        "errorType": "errorObject",
        "errorObject": "{\n  \"title\": \"Effort Estimation\",\n  \"message\": \"Unfortunately, something went wrong while generating the effort estimation. Please try again or upload a revised RFP if the issue persists.\"\n}"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -3424,
        6096
      ],
      "id": "4ac2a8c4-7ed5-44f7-85af-91204f800033",
      "name": "Stop and Error6"
    },
    {
      "parameters": {
        "errorType": "errorObject",
        "errorObject": "{\n  \"title\": \"Roadmap\",\n  \"message\": \"Unfortunately, something went wrong while generating the roadmap. Please try again or upload a revised RFP if the issue persists.\"\n}"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -1664,
        5680
      ],
      "id": "5b13e3bf-3db3-449a-bb65-306b371187ac",
      "name": "Stop and Error7"
    },
    {
      "parameters": {
        "errorType": "errorObject",
        "errorObject": "{\n  \"title\": \"Final Report\",\n  \"message\": \"Unfortunately, something went wrong while generating the final report. Please try again or upload a revised RFP if the issue persists.\"\n}"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -224,
        5728
      ],
      "id": "6d91aa7c-322b-4fa7-8d6a-d271809d193e",
      "name": "Stop and Error8"
    },
    {
      "parameters": {
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -3552,
        7936
      ],
      "id": "0bac5026-9a88-4dc3-9a00-619c4573fb51",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {
          "temperature": 0.1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -3856,
        4736
      ],
      "id": "69ff293f-e0ae-4c7c-83d6-12656d1977c4",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "M8xqWvEC6mH6LNuk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {
          "temperature": 0.1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -3904,
        6320
      ],
      "id": "79ab072d-2715-420d-a993-333a61712ffb",
      "name": "OpenAI Chat Model8",
      "credentials": {
        "openAiApi": {
          "id": "M8xqWvEC6mH6LNuk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteRows",
        "dataTableId": {
          "__rl": true,
          "value": "qS4XuYo2wZl1DdYR",
          "mode": "list",
          "cachedResultName": "Estimation Tool",
          "cachedResultUrl": "/projects/NM7VZoSXkcKo262s/datatables/qS4XuYo2wZl1DdYR"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "execution_id",
              "keyValue": "="
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        416,
        6176
      ],
      "id": "e35b20d0-7734-4f06-8e9d-b9e20fe671c5",
      "name": "Delete row(s)"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sse-estimation-tool.onrender.com/progress",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ $json.body }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2896,
        2272
      ],
      "id": "ea75c621-fd16-4ddb-bc50-27b51d2127e1",
      "name": "SSE - Document Preparation"
    },
    {
      "parameters": {
        "jsCode": "// Get sessionId from the RFP Upload node\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\n// Transform into the desired format\n// return [{\n//   json: {\n//     step: \"document_preparation\",\n//     title: \"Step 1: Document Preparation\", \n//     sessionId: sessionId,\n//     output: JSON.stringify(outputData || {})\n//   }\n// }];\n\nconst payload = {\n    step: \"document_preparation\",\n    title: \"Step 1: Document Preparation\", \n    sessionId: sessionId,\n    output: \"Document parsed\"\n};\n\nreturn [\n  {\n    json: {\n      body: JSON.stringify(payload)\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3088,
        2272
      ],
      "id": "dcd20366-70ac-4475-91ea-d5b626df7136",
      "name": "Prepare for frontend"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT EXISTS (\n    SELECT 1 FROM information_schema.tables \n    WHERE table_schema = 'public' \n    AND table_name = '{{ $('Start RFP Analysis').item.json.body.indexName }}'\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -4224,
        2544
      ],
      "id": "0889ecae-1d41-408e-8902-19dc371f5c73",
      "name": "Check Table Exist",
      "credentials": {
        "postgres": {
          "id": "wK2pSCG9jTniRU28",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "202ea6d4-41ce-407f-ba5d-499c98b497a6",
              "leftValue": "={{ $json.exists }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4048,
        2544
      ],
      "id": "6d4f9b88-6c56-4cc1-8a93-5a0aa230a2fb",
      "name": "If table exists"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT EXISTS (\n    SELECT 1 FROM {{ $('Start RFP Analysis').item.json.body.indexName }} LIMIT 1\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3824,
        2208
      ],
      "id": "a3feef1d-01a8-41bf-868b-d326beca5063",
      "name": "Is Table Populated",
      "credentials": {
        "postgres": {
          "id": "wK2pSCG9jTniRU28",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "202ea6d4-41ce-407f-ba5d-499c98b497a6",
              "leftValue": "={{ $json.exists }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3632,
        2208
      ],
      "id": "8d233a6e-fd5d-4085-b090-f89bf852d1c9",
      "name": "If table populated"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT create_rfp_table('{{ $('Start RFP Analysis').item.json.body.indexName }}');",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3824,
        2560
      ],
      "id": "048c8d4a-ae5e-4ac0-8055-352d16a579b2",
      "name": "Create RFP Table",
      "credentials": {
        "postgres": {
          "id": "wK2pSCG9jTniRU28",
          "name": "Postgres account 2"
        }
      }
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "qS4XuYo2wZl1DdYR",
          "mode": "list",
          "cachedResultName": "Estimation Tool",
          "cachedResultUrl": "/projects/NM7VZoSXkcKo262s/datatables/qS4XuYo2wZl1DdYR"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "execution_id": "={{$execution.id}}",
            "session_id": "={{ $json.body.sessionId }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "execution_id",
              "displayName": "execution_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "optimizeBulk": false
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -4400,
        2544
      ],
      "id": "0f034adb-7903-41c1-b1a5-b17669a264a5",
      "name": "Add Execution id"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "aKpGZQLxTLr3FkPY",
          "mode": "list",
          "cachedResultUrl": "/workflow/aKpGZQLxTLr3FkPY",
          "cachedResultName": "RFP Analysis Public - Ingestion"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionId": "={{ $('Start RFP Analysis').item.json.body.sessionId }}",
            "md5": "={{ $('Start RFP Analysis').item.json.body.md5 }}",
            "fileName": "={{ $('Start RFP Analysis').item.json.body.fileName }}",
            "date": "={{ $('Start RFP Analysis').item.json.body.date }}",
            "link": "={{ $('Start RFP Analysis').item.json.body.link }}",
            "indexName": "={{ $('Start RFP Analysis').item.json.body.indexName }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "sessionId",
              "displayName": "sessionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "md5",
              "displayName": "md5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "fileName",
              "displayName": "fileName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "link",
              "displayName": "link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "indexName",
              "displayName": "indexName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -3632,
        2560
      ],
      "id": "3440dc38-b363-4989-89fc-8ef70126769e",
      "name": "File Ingestion - Full",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "aKpGZQLxTLr3FkPY",
          "mode": "list",
          "cachedResultUrl": "/workflow/aKpGZQLxTLr3FkPY",
          "cachedResultName": "RFP Analysis Public - Ingestion"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionId": "={{ $('Start RFP Analysis').item.json.body.sessionId }}",
            "md5": "={{ $('Start RFP Analysis').item.json.body.md5 }}",
            "fileName": "={{ $('Start RFP Analysis').item.json.body.fileName }}",
            "date": "={{ $('Start RFP Analysis').item.json.body.date }}",
            "link": "={{ $('Start RFP Analysis').item.json.body.link }}",
            "indexName": "={{ $('Start RFP Analysis').item.json.body.indexName }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "sessionId",
              "displayName": "sessionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "md5",
              "displayName": "md5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "fileName",
              "displayName": "fileName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "link",
              "displayName": "link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "indexName",
              "displayName": "indexName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -3296,
        2000
      ],
      "id": "6111feea-055f-433a-8dd0-a01b46724b7b",
      "name": "File Ingestion - Full1",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "deleteRows",
        "dataTableId": {
          "__rl": true,
          "value": "qS4XuYo2wZl1DdYR",
          "mode": "list",
          "cachedResultName": "Estimation Tool",
          "cachedResultUrl": "/projects/NM7VZoSXkcKo262s/datatables/qS4XuYo2wZl1DdYR"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "execution_id",
              "keyValue": "={{ $execution.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -3456,
        2608
      ],
      "id": "f6f61be5-22c5-40fb-8598-7689e43fdc31",
      "name": "Delete row(s)1"
    },
    {
      "parameters": {
        "operation": "deleteRows",
        "dataTableId": {
          "__rl": true,
          "value": "qS4XuYo2wZl1DdYR",
          "mode": "list",
          "cachedResultName": "Estimation Tool",
          "cachedResultUrl": "/projects/NM7VZoSXkcKo262s/datatables/qS4XuYo2wZl1DdYR"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "execution_id",
              "keyValue": "={{ $execution.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -3120,
        2000
      ],
      "id": "6887472a-2de0-4a29-adca-d9fe95544cd4",
      "name": "Delete row(s)2"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -3280,
        2608
      ],
      "id": "c9a419c6-1b09-44b4-83f5-b3bbafa3beaf",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -2960,
        2000
      ],
      "id": "819209c2-a7fd-4461-8910-110ce97e952f",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"platforms\": [\n    {\n      \"enum\": \"ENUM_VALUE\",\n      \"text\": \"Platform text\"\n    }\n  ],\n  \"rationale\": \"Brief explanation for each platform identified\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -3248,
        3280
      ],
      "id": "9f65748e-497c-4247-809d-08cafd9d79ef",
      "name": "Platforms + Rationale1"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        -3376,
        3296
      ],
      "id": "b3aee478-3d85-45e7-bb20-072b2eb31fa3",
      "name": "Think3"
    },
    {
      "parameters": {
        "jsCode": "const contextForPrompt = $input.first().json.context;\n\nconst systemPrompt = \"You are a precise assistant that extracts structured insights from project documents, such as RFPs or technical scopes. Your primary goal is to identify platform requirements based on the content provided. Focus on what is clearly described, but use practical software development reasoning when appropriate: - If a frontend (web or mobile) is described in detail, and no backend is mentioned, assume a backend is required unless the RFP explicitly states otherwise.- If user-facing workflows imply system control or role management, you may reasonably infer that an admin interface is needed. Never invent features or platforms not supported by the text or standard architectural logic. If something is unclear or missing, say so clearly. Be structured, realistic, and accurate in all your conclusions.\";\n\nconst userPrompt = `You are reviewing excerpts from an RFP document to determine which technology platforms are explicitly required.\n\n### excerpts:\n\n${contextForPrompt}\n\nInstructions:\n- Only list platforms that are clearly described or required in the text.\n- **CRITICAL: When referencing information from the excerpts, ALWAYS cite your sources using [1], [2], [3], etc. based on the excerpt numbers shown above.**\n- For each platform you list, provide a **short rationale** explaining what in the text led you to include it, including specific citations.\n- If no platforms are clearly required, say: \"No platform requirements explicitly stated.\"\n\nOnly identify platforms from the list below and use EXACTLY these enum values and text formats:\n- {\"enum\": \"WEB\", \"text\": \"Web application\"}\n- {\"enum\": \"MOBILE\", \"text\": \"Mobile app\"} (mention iOS/Android in rationale if stated)\n- {\"enum\": \"BACKEND_API\", \"text\": \"Backend/API services\"}\n- {\"enum\": \"ADMIN_PORTAL\", \"text\": \"Admin portal/dashboard\"}\n- {\"enum\": \"DESKTOP\", \"text\": \"Desktop application\"}\n- {\"enum\": \"IOT\", \"text\": \"IoT/Embedded system\"}\n- {\"enum\": \"KIOSK\", \"text\": \"Kiosk system\"}\n\n**Additional notes**:\n- If a web or mobile frontend is clearly described but no backend is mentioned, **assume a backend is needed** and include {\"enum\": \"BACKEND_API\", \"text\": \"Backend/API services\"} unless explicitly stated otherwise.\n- If the RFP includes user-facing features that typically require admin management (e.g., content moderation, approval workflows, user roles), you may infer that an **admin portal** is required even if not explicitly named - use {\"enum\": \"ADMIN_PORTAL\", \"text\": \"Admin portal/dashboard\"}.\n\nRemember: Base your answers strictly on the provided Context.  \nYou may make minimal inferences only when explicitly allowed in the instructions above (e.g., assuming a backend for a described frontend).  \nDo not invent platform requirements beyond that.\n\n**IMPORTANT: Format the rationale field using markdown markup with citations:**\n- Use **bold text** for key points and important terms\n- Include [1], [2], etc. citations when referencing specific excerpts\n- Use ## headers for main sections\n- Use bullet points (- item) for lists\n- Structure the rationale with clear sections and hierarchy\n\n**Example rationale format:**\n\"## Platform Identified\n### Web Application\n- **Explicitly stated** as 'web-based dashboard' in excerpt [1]\n- Browser compatibility requirements mentioned in [3] confirming web platform\n- Responsive design requirements in [2] further support web-based architecture\"\n`;\n\nreturn {\n  json: {\n    userPrompt,\n    systemPrompt: systemPrompt\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3680,
        3072
      ],
      "id": "c414426c-5c0b-463b-9c59-c6607147aa88",
      "name": "PreparePrompts - Platforms"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -3488,
        3072
      ],
      "id": "a62898c0-8794-44db-91a5-f6bfdf8c371c",
      "name": "Get Platforms"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node - Parse LLM Response with Full Traceability\n */\nconst llmResponse = $input.first().json.output;\nconst referenceMap = $('Platforms Retrieve Chunks').first().json.reference_map;\nconst originalChunks = $('Platforms Retrieve Chunks').first().json.original_chunks;\n\n// Extract unique cited references from rationale\nconst rationale = llmResponse.rationale || \"\";\nconst citedRefMatches = rationale.match(/\\[(\\d+)\\]/g) || [];\nconst uniqueRefNumbers = [...new Set(citedRefMatches.map(ref => \n  parseInt(ref.replace(/[\\[\\]]/g, ''))\n))];\n\n// Build deduplicated highlight data with text\nconst highlights = [];\nconst seen = new Set();\n\nuniqueRefNumbers.forEach(refNum => {\n  const chunk = referenceMap.find(r => r.ref_number === refNum);\n  const originalChunk = originalChunks[refNum - 1]; // Get original chunk text\n  \n  if (chunk && originalChunk) {\n    chunk.bboxes.forEach(bbox => {\n      const key = `${bbox.page_no}_${chunk.chunk_id}_${bbox.bbox.l}_${bbox.bbox.t}`;\n      \n      if (!seen.has(key)) {\n        seen.add(key);\n        highlights.push({\n          ref_number: refNum,\n          chunk_id: chunk.chunk_id,\n          page: bbox.page_no,\n          coordinates: bbox.bbox,\n          text: originalChunk.text,  // Add full chunk text\n          text_preview: originalChunk.text.substring(0, 200) + \"...\"  // Short preview\n        });\n      }\n    });\n  }\n});\n\n// Return with complete traceability\nreturn [{\n  json: {\n    output: {\n    platforms: llmResponse.platforms,\n    rationale: llmResponse.rationale,\n    highlight_data: highlights\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3152,
        3072
      ],
      "id": "27d02e6f-0718-40ff-a7ea-205493097f21",
      "name": "Parse With Citations - Platforms"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node\n * Input  : first item from the previous “platform extraction” node\n *          {\n *            output: {\n *              platforms: [ ... ],\n *              rationale: \"...\"\n *            }\n *          }\n * Output : { detectedPlatformsSnippet: '### DETECTED_PLATFORMS …' }\n */\n\nconst { output } = $('Parse With Citations - Platforms').first().json;\n// --- Basic sanity check ----------------------------------------------------\nif (!output?.platforms || !Array.isArray(output.platforms)) {\n  throw new Error('Expected output.platforms array from previous step.');\n}\n\nconst stripCitations = (text) => {\n  if (!text) return text;\n  return text.replace(/\\[\\d+\\]/g, '').replace(/\\s+/g, ' ').trim();\n};\n\n\noutput.rationale = stripCitations(output.rationale);\n\n// --- Build the snippet -----------------------------------------------------\nconst detectedPlatformsSnippet = [\n  '### DETECTED_PLATFORMS (authoritative, extracted in a prior step)',\n  JSON.stringify(\n    {\n      platforms: output.platforms,\n      rationale: output.rationale,\n    },\n    null,\n    2 // pretty-print indent\n  ),\n  '',\n  'You must treat the array in \"platforms\" as ground truth when selecting or defaulting technologies.',\n].join('\\n');\n\n// --- Return for the next node ---------------------------------------------\nreturn [\n  {\n    json: {\n      detectedPlatformsSnippet,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2944,
        3072
      ],
      "id": "beac7f96-750c-4d39-81e3-a8a49607e987",
      "name": "Downstream LLM Output - Platforms"
    },
    {
      "parameters": {
        "jsCode": "\nconst outputs = $('Parse With Citations - Platforms').first().json.output;\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\nconst payload = {\n  step: \"platforms\",\n  title: \"Step 2. Platforms Info\",\n  sessionId:sessionId,\n  output: JSON.stringify(outputs ?? {}),\n};\n\nreturn [\n  {\n    json: {\n      platforms: JSON.stringify(payload)\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2624,
        3056
      ],
      "id": "7caced21-5066-42a7-ae53-147cc03224bc",
      "name": "Prepare for frontend - Platforms"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sse-estimation-tool.onrender.com/progress",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ $json.platforms }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2416,
        3056
      ],
      "id": "36ecbe61-e609-42d4-8039-e74ef9179003",
      "name": "SSE - Platforms"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -3552,
        3328
      ],
      "id": "09bb50ce-ed9f-4981-a7ac-5d1cf737c246",
      "name": "GPT 4.1-Mini",
      "credentials": {
        "openAiApi": {
          "id": "M8xqWvEC6mH6LNuk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// n8n Function Node - Prepare Confidence Scoring\nconst platformData = $input.first().json.output;\nconst platforms = platformData.platforms;\nconst rationale = platformData.rationale;\nconst highlightData = platformData.highlight_data;\n\n// Build excerpt reference map\nconst excerptMap = {};\nhighlightData.forEach(item => {\n  excerptMap[item.ref_number] = {\n    chunk_id: item.chunk_id,\n    text: item.text,\n    page: item.page\n  };\n});\n\n\n\nconst systemPrompt = `You are a precision analyst that evaluates the strength of evidence for technical decisions. You assess confidence based on explicit mentions, citation quality, and logical inference strength.`;\n\nconst userPrompt = `Analyze the confidence level for each platform identification based on the provided evidence.\n\n## Identified Platforms:\n${JSON.stringify(platforms, null, 2)}\n\n## Analysis Rationale:\n${rationale}\n\n## Referenced Excerpts:\n${highlightData.map(h => `[${h.ref_number}]: \"${h.text.substring(0, 200)}...\" (Page ${h.page})`).join('\\n\\n')}\n\n## Task:\nFor EACH platform listed above, provide a confidence assessment based on:\n\n1. **Evidence Type**:\n   - Was it explicitly stated (e.g., \"web-based dashboard\")?\n   - Was it a standard architectural inference (e.g., backend for frontend)?\n   - Was it implied through requirements?\n\n2. **Citation Strength**:\n   - How many excerpts support this platform?\n   - Are the references direct or indirect?\n\n3. **Clarity of Requirements**:\n   - Is the platform description detailed or vague?\n   - Are there specific technical requirements mentioned?\n\n## Confidence Scale:\n- **HIGH (85-100%)**: Explicitly stated with multiple supporting references and clear requirements\n- **MEDIUM (60-84%)**: Either explicitly stated with limited detail OR strongly implied with good evidence\n- **LOW (30-59%)**: Inferred based on standard practices with minimal direct evidence\n- **VERY LOW (<30%)**: Speculative based on weak signals\n\nBase your confidence ONLY on the evidence provided in the rationale and excerpts. Do not add new platforms or change existing identifications.`;\n\nreturn {\n  json: {\n    systemPrompt,\n    userPrompt,\n    originalData: platformData // Pass through for merging later\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -704,
        1104
      ],
      "id": "92a55652-e602-468e-ae37-5005516f1de6",
      "name": "PreparePrompts - Platforms Confidence"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -512,
        1104
      ],
      "id": "a1f48e06-cc2b-4ca1-a1fb-c4457abd5c7c",
      "name": "Get Platforms Confidences"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"confidence_scores\": [\n    {\n      \"platform_enum\": \"WEB\",\n      \"confidence_level\": \"HIGH\",\n      \"confidence_percentage\": 95,\n      \"evidence_assessment\": {\n        \"evidence_type\": \"explicit|standard|implied\",\n        \"supporting_excerpts\": [3, 7, 1],\n        \"strength_rationale\": \"Explicitly named as 'web-based admin dashboard' in multiple excerpts with detailed browser requirements\"\n      }\n    }\n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -368,
        1312
      ],
      "id": "da2789de-6ba5-41f7-b81d-fd83fb6dcd14",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "jsCode": "// n8n Function Node - Merge Platform and Confidence Data\n// Simplified merge function\nfunction simpleMerge(platformOutput, confidenceOutput) {\n  const platforms = platformOutput.output.platforms;\n  const confidenceScores = confidenceOutput.output.confidence_scores;\n  \n  // Map confidence to platforms\n  const enhanced = platforms.map(p => {\n    const conf = confidenceScores.find(c => c.platform_enum === p.enum);\n    return {\n      ...p,\n      confidence_level: conf?.confidence_level || \"UNKNOWN\",\n      evidence_type: conf?.evidence_assessment.evidence_type,\n      supporting_excerpts: conf?.evidence_assessment.supporting_excerpts,\n      strength_rationale: conf?.evidence_assessment.strength_rationale\n    };\n  });\n  \n  return {\n    output:{\n    ...platformOutput.output,\n    platforms: enhanced\n  }\n  };\n}\n\n// Main execution\nconst platformData = $('Parse With Citations - Platforms').first().json;  // First LLM output\nconst confidenceData =  $input.first().json // Confidence LLM output\n\ntry {\n  const mergedResult = simpleMerge(platformData, confidenceData);\n  \n  return {\n    json: mergedResult\n  };\n} catch (error) {\n  throw new Error(`Failed to merge platform and confidence data: ${error.message}`);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -224,
        1104
      ],
      "id": "508197e8-5c81-4047-aa42-e22f29b59761",
      "name": "Map confidence to platforms"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "yBeOa0XzKuKyQKkJ",
          "mode": "list",
          "cachedResultUrl": "/workflow/yBeOa0XzKuKyQKkJ",
          "cachedResultName": "Estimation Tool - Chunk Retriever"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query_embed_for_sorting": "search_query: What are all the target platforms, deployment environments, and devices that the system needs to support, including web, mobile, desktop admin?",
            "error_title": "Platforms",
            "error_desc": "Unfortunately, we couldn’t identify the target platforms from your RFP. Since this information is essential for the analysis, the process has been halted.",
            "index_name": "={{ $('Start RFP Analysis').item.json.body.indexName }}",
            "queries_embed_full_array": "={{ $json.queries_embed_full_array }}",
            "topic_keyword": "platforms",
            "num_of_chunks": 7
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query_embed_for_sorting",
              "displayName": "query_embed_for_sorting",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "index_name",
              "displayName": "index_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "error_title",
              "displayName": "error_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "error_desc",
              "displayName": "error_desc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "queries_embed_full_array",
              "displayName": "queries_embed_full_array",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "array",
              "removed": false
            },
            {
              "id": "topic_keyword",
              "displayName": "topic_keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "num_of_chunks",
              "displayName": "num_of_chunks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -3920,
        3072
      ],
      "id": "bdfe75a5-c9e3-424a-b7a5-7db0002dd03a",
      "name": "Platforms Retrieve Chunks"
    },
    {
      "parameters": {
        "jsCode": "// Function node that outputs a single item with an array\nconst platforms = [\n  {\n    query_type: \"web\",\n    query: \"What web technologies or platforms are mentioned in the RFP?\",\n    keywords: \"web technology, technologies, platform, platforms, website, webapp, web application, HTML, CSS, JavaScript, TypeScript, React, Angular, Vue, Svelte, Next.js, Nuxt.js, PHP, Python, Django, Flask, Ruby, Rails, Node.js, Express, .NET, ASP.NET, Java, Spring, Laravel, Drupal, WordPress, CMS, frontend, backend, server-side, client-side, SaaS, PaaS, cloud hosting\",\n    phrase: \"web technology platform web application\",\n    rescore_query: \"web application OR React OR Angular OR Vue OR HTML OR CSS\"\n  },\n  {\n    query_type: \"mobile\",\n    query: \"Is a mobile app required or mentioned in the RFP? Android, iOS or Flutter?\",\n    keywords: \"mobile app, application, Android, iOS, Flutter, React Native, Swift, Kotlin, cross-platform, smartphone, tablet, mobile device, iPhone, iPad, Play Store, App Store\",\n    phrase: \"mobile application mobile app\",\n    rescore_query: \"mobile app OR Android OR iOS OR Flutter OR React Native\"\n  },\n  {\n    query_type: \"backend\",\n    query: \"Are there backend services or APIs involved in the RFP?\",\n    keywords: \"backend service, services, API, APIs, REST, RESTful, GraphQL, server, database, microservice, microservices, endpoint, endpoints, integration, integration layer, middleware, backend system, data storage, authentication, authorization, business logic\",\n    phrase: \"backend service API integration\",\n    rescore_query: \"REST API OR GraphQL OR microservice OR backend service\"\n  },\n  {\n    query_type: \"admin\",\n    query: \"Does the RFP include an admin portal or dashboard?\",\n    keywords: \"admin portal, dashboard, administration, control panel, admin interface, management console, backend portal, admin dashboard, reporting, analytics, monitoring, configuration settings, user management\",\n    phrase: \"admin portal admin dashboard\",\n    rescore_query: \"admin portal OR admin dashboard OR management console\"\n  },\n  {\n    query_type: \"desktop\",\n    query: \"Is desktop software or a desktop client part of the RFP scope?\",\n    keywords: \"desktop software, client application, Windows, MacOS, Linux, desktop app, Electron, desktop client, installable application, native desktop, cross-platform desktop, program, executable\",\n    phrase: \"desktop software desktop client\",\n    rescore_query: \"desktop app OR Electron OR native desktop\"\n  },\n  {\n    query_type: \"kiosk\",\n    query: \"Are kiosk systems or interfaces required in the RFP?\",\n    keywords: \"kiosk system, systems, interface, interfaces, self-service terminal, touch screen, touchscreen, kiosk application, kiosk mode, interactive kiosk, public kiosk, digital kiosk, POS, point of sale\",\n    phrase: \"kiosk system kiosk interface\",\n    rescore_query: \"kiosk interface OR touchscreen OR point of sale\"\n  },\n  {\n    query_type: \"system-architecture\",\n    query: \"Describe the overall system structure and functionality mentioned in the RFP.\",\n    keywords: \"system structure, architecture, functionality, components, modules, workflow, process, integration, overview, system design, system diagram, technical architecture, high-level design, system overview\",\n    phrase: \"system structure system functionality\",\n    rescore_query: \"system architecture OR technical architecture OR system design\"\n  },\n  {\n    query_type: \"technical-components\",\n    query: \"What are the main technical or system components described in the RFP?\",\n    keywords: \"technical component, components, system element, elements, module, modules, subsystem, subsystems, architecture, infrastructure, technology stack, platform, integration, interface, API, backend, frontend, database, server, client\",\n    phrase: \"technical component system component\",\n    rescore_query: \"technical component OR system module OR technology stack\"\n  }\n];\n\n// Return as a single item with the platforms array inside\nreturn [{\n  json: {\n    queries_embed_full_array: platforms\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4080,
        3072
      ],
      "id": "890fd97e-758f-4fcd-8276-219244b0cb23",
      "name": "Prepare Queries - Platforms"
    },
    {
      "parameters": {
        "content": "## Inference Functional Requirements\n\n",
        "height": 524,
        "width": 2904,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4544,
        3552
      ],
      "id": "ae8a63b3-3745-43d7-8e8f-a9305fe3d7aa",
      "name": "Sticky Note6"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        -3376,
        3872
      ],
      "id": "0572bcf3-9b93-4b49-98c3-fc492b96d615",
      "name": "Think4"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -3504,
        3872
      ],
      "id": "791e2859-a081-4e08-a4c6-cf2043414542",
      "name": "GPT 4.1-Mini1",
      "credentials": {
        "openAiApi": {
          "id": "M8xqWvEC6mH6LNuk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"confidence_scores\": [\n    {\n      \"requirement_title\": \"Exact title from original requirement\",\n      \"requirement_description\": \"Exact description from original requirement\",\n      \"confidence_level\": \"HIGH|MEDIUM|LOW|VERY_LOW\",\n      \"confidence_percentage\": 95,\n      \"evidence_assessment\": {\n        \"evidence_type\": \"explicit|standard|implied\",\n        \"supporting_excerpts\": [5, 6],\n        \"strength_rationale\": \"Brief explanation of why this confidence level\"\n      }\n    }\n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -896,
        1152
      ],
      "id": "6cd458b2-acc9-4213-b6b6-9b9d409bde43",
      "name": "Structured Output Parser2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -3488,
        3648
      ],
      "id": "faaa640a-194e-48f9-be4d-a14a5de6bee0",
      "name": "Get Functional Requirements"
    },
    {
      "parameters": {
        "jsCode": "const queries = [\n{\n    query_type: \"feature_backlog\",\n    query:\n      \"Extract every user-facing feature, workflow, module, and use-case described in the RFP that will drive development effort.\",\n    /* Core verbs + backlog vocabulary (no compliance or legal terms) */\n    keywords: [\n      /* imperative verbs that usually start requirements */\n      \"shall\", \"must\", \"will\", \"should\", \"enable\", \"allow\", \"support\",\n\n      /* backlog & requirements terminology */\n      \"feature\", \"features\", \"functionality\", \"functional\", \"user story\",\n      \"user stories\", \"story\", \"stories\", \"epic\", \"use case\", \"use cases\",\n      \"acceptance criterion\", \"acceptance criteria\", \"requirement\",\n      \"requirements\", \"deliverable\", \"deliverables\",\n\n      /* common software capabilities */\n      \"dashboard\", \"report\", \"reporting\", \"search\", \"filter\", \"export\",\n      \"import\", \"authentication\", \"authorization\", \"login\", \"registration\",\n      \"profile\", \"notification\", \"messaging\", \"chat\", \"payment\", \"checkout\",\n      \"file upload\", \"download\", \"analytics\", \"admin panel\", \"cms\", \"api\",\n\n      /* workflow & domain phrases */\n      \"workflow\", \"process\", \"approval\", \"review\", \"comment\", \"feedback\",\n\n      /* MVP / release language */\n      \"MVP\", \"minimum viable product\", \"phase 1\", \"phase one\",\n      \"initial release\", \"pilot\", \"beta\"\n    ],\n\n    /* Phrase to give extra boost to clearly written requirements */\n    phrase: \"shall must will should feature user story use case\",\n\n    /* Tightest phrase for rescoring */\n    rescore_query: \"user story OR feature OR use case\",\n\n    description:\n      \"Surface all functional features and backlog items that drive development effort; ignore regulatory or contractual statements.\"\n  }\n];\n\n// Return as a single item with the platforms array inside\nreturn [{\n  json: {\n    queries_embed_full_array: queries\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4080,
        3648
      ],
      "id": "f10086a3-ed2e-4645-bcfb-9e32a167ba95",
      "name": "Prepare Queries - FN"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "yBeOa0XzKuKyQKkJ",
          "mode": "list",
          "cachedResultUrl": "/workflow/yBeOa0XzKuKyQKkJ",
          "cachedResultName": "Estimation Tool - Chunk Retriever"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query_embed_for_sorting": "search_query: Extract every user-facing feature, workflow, module, and use-case described in the RFP that will drive development effort.",
            "error_title": "Functional Requirements",
            "error_desc": "Unfortunately, we couldn’t identify the functional requirements from your RFP. Since this information is essential for the analysis, the process has been halted.",
            "index_name": "={{ $('Start RFP Analysis').item.json.body.indexName }}",
            "queries_embed_full_array": "={{ $json.queries_embed_full_array }}",
            "topic_keyword": "functional_requirements",
            "num_of_chunks": 12
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query_embed_for_sorting",
              "displayName": "query_embed_for_sorting",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "index_name",
              "displayName": "index_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "error_title",
              "displayName": "error_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "error_desc",
              "displayName": "error_desc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "queries_embed_full_array",
              "displayName": "queries_embed_full_array",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "array",
              "removed": false
            },
            {
              "id": "topic_keyword",
              "displayName": "topic_keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "num_of_chunks",
              "displayName": "num_of_chunks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -3872,
        3648
      ],
      "id": "21b3da48-1099-481a-b242-df16b0d5d07e",
      "name": "FN Retrieve Chunks"
    },
    {
      "parameters": {
        "jsCode": "// Format the context\nconst contextForPrompt = $input.first().json.context;\n\nconst systemPrompt = \"You are a strict JSON extractor. The user will supply raw excerpts from a software RFP that describe project scope and backlog. Identify every distinct Functional Requirement (what the system must do). Do NOT invent, merge, or omit anything. Return **only** a valid JSON array—no headings, no markdown, no extra text.\";\n\nconst userPrompt = `Below are excerpts from an RFP that describe the project scope, backlog items, and milestones.\n\n### excerpts:\n${contextForPrompt}\n\nYour task is to extract all meaningful features and expectations and assign them to the Functional Requirement (FR) category - what the system must do.\n\nInstructions:\n- Do not skip, combine, or summarize any features.\n- **CRITICAL: When describing requirements, ALWAYS cite your sources using [1], [2], [3], etc. based on the excerpt numbers shown above.**\n- Include citation numbers directly in the description text to show which excerpts support each requirement.\n- Do not refer to \"the document\" or mention formatting.\n- Do not include commentary, labels, headings, or markdown blocks.\n- Sort results using section numbers, ascending.\n- Do not include documentation requirements.\n\nInstructions:\n- Extract every distinct functional requirement clearly described in the text\n- **Group similar requirements together when they apply to multiple entities**\n- Example: Instead of \"Create records for Entity A\", \"Create records for Entity B\", \"Create records for Entity C\", \n  write one requirement: \"Create records for all entities (A, B, C) via simple forms [5], [6]\"\n- Maximum 100 words per requirement description\n- Each requirement must be independently understandable\n- Preserve technical specifications exactly as stated (numbers, percentages, timeframes)\n\n**Output Format - Return ONLY valid JSON:**\n\n`;\n\nreturn {\n  json: {\n    userPrompt,\n    systemPrompt\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3680,
        3648
      ],
      "id": "bbccf250-2ccc-4d56-a0a5-d24c1529ff79",
      "name": "PreparePrompts - FN"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"features\": [\n    {\n      \"feature_title\": \"User Authentication\",\n      \"feature_description\": \"The system must provide secure user authentication with username and password [1]. Multi-factor authentication (MFA) is required [3], including SMS and authenticator app options.\"\n    },\n    {\n      \"feature_title\": \"Content Approval Workflow\",\n      \"feature_description\": \"Content submissions require review before publication [2]. Admin users must be able to approve or reject content with comments [5].\"\n    }\n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -3248,
        3856
      ],
      "id": "9b3f614c-62a3-4590-afe9-8ea21d609c18",
      "name": "FN"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node - Parse Functional Requirements with Full Traceability\n */\nconst llmResponse = $input.first().json.output;\nconst referenceMap = $('FN Retrieve Chunks').first().json.reference_map;\nconst originalChunks = $('FN Retrieve Chunks').first().json.original_chunks;\n\n// Extract unique cited references from ALL feature descriptions\nconst allDescriptions = llmResponse.features.map(f => f.feature_description).join(' ');\nconst citedRefMatches = allDescriptions.match(/\\[(\\d+)\\]/g) || [];\nconst uniqueRefNumbers = [...new Set(citedRefMatches.map(ref => \n  parseInt(ref.replace(/[\\[\\]]/g, ''))\n))];\n\n// Build deduplicated highlight data with text\nconst highlights = [];\nconst seen = new Set();\n\nuniqueRefNumbers.forEach(refNum => {\n  const chunk = referenceMap.find(r => r.ref_number === refNum);\n  const originalChunk = originalChunks[refNum - 1]; // Get original chunk text\n  \n  if (chunk && originalChunk) {\n    chunk.bboxes.forEach(bbox => {\n      const key = `${bbox.page_no}_${chunk.chunk_id}_${bbox.bbox.l}_${bbox.bbox.t}`;\n      \n      if (!seen.has(key)) {\n        seen.add(key);\n        highlights.push({\n          ref_number: refNum,\n          chunk_id: chunk.chunk_id,\n          page: bbox.page_no,\n          coordinates: bbox.bbox,\n          text: originalChunk.text,  // Add full chunk text\n          text_preview: originalChunk.text.substring(0, 200) + \"...\"  // Short preview\n        });\n      }\n    });\n  }\n});\n\n// Add citation mapping to each feature (which chunks support this feature)\nconst featuresWithCitations = llmResponse.features.map(feature => {\n  // Extract citation numbers from this feature's description\n  const featureCitations = (feature.feature_description.match(/\\[(\\d+)\\]/g) || [])\n    .map(ref => parseInt(ref.replace(/[\\[\\]]/g, '')));\n  \n  // Get the highlight data for these citations\n  const featureHighlights = highlights.filter(h => \n    featureCitations.includes(h.ref_number)\n  );\n  \n  return {\n    ...feature,\n    citations: featureCitations,\n    highlight_data: featureHighlights\n  };\n});\n\n// Return with complete traceability\nreturn [{\n  json: {\n    output: {\n      features: featuresWithCitations,\n      all_highlights: highlights, // All highlights across all features\n      summary: {\n        total_features: featuresWithCitations.length,\n        total_citations: uniqueRefNumbers.length,\n        total_highlights: highlights.length\n      }\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3152,
        3648
      ],
      "id": "b63ba373-f3f9-41f2-8283-20c0bd1c6805",
      "name": "Parse With Citations - FN"
    },
    {
      "parameters": {
        "jsCode": "// n8n Function Node - Prepare Confidence Scoring for Functional Requirements\nconst featuresData = $input.first().json.output;\nconst features = featuresData.features;\nconst allHighlights = featuresData.all_highlights || [];\n\n// Build excerpt reference map from all highlights (excluding bbox for prompt)\nconst excerptMap = {};\nallHighlights.forEach(item => {\n  excerptMap[item.ref_number] = {\n    chunk_id: item.chunk_id,\n    text: item.text,\n    page: item.page\n    // NOTE: Keeping coordinates in data but NOT in prompt\n  };\n});\n\nconst systemPrompt = `You are a precision analyst that evaluates the strength of evidence for functional requirements extraction. You assess confidence based on explicit requirement statements, citation quality, and the clarity of \"must have\" vs \"should have\" language. Return your analysis as structured JSON.`;\n\nconst userPrompt = `Analyze the confidence level for each functional requirement based on the provided evidence.\n\n## Identified Functional Requirements:\n${JSON.stringify(features.map(feature => ({\n  title: feature.feature_title,\n  description: feature.feature_description,\n  citations: feature.citations\n})), null, 2)}\n\n## Referenced Excerpts:\n${allHighlights.map(h => `[${h.ref_number}]: \"${h.text.substring(0, 400)}...\" (Page ${h.page})`).join('\\n\\n')}\n\n## Task:\nFor EACH functional requirement listed above, provide a confidence assessment.\n\n## Evaluation Criteria:\n1. **Requirement Language Strength**:\n   - **Explicit**: Uses \"must\", \"shall\", \"required\" language\n   - **Standard**: Uses \"should\", \"needs to\" or describes expected functionality\n   - **Implied**: Inferred from workflow descriptions or use cases\n\n2. **Citation Quality**:\n   - How many excerpts directly support this requirement?\n   - Are references explicit requirement statements or contextual?\n\n3. **Specificity**:\n   - Clear, measurable criteria vs. vague expectations\n   - Detailed specifications vs. general capabilities\n\n## Confidence Scale:\n- **HIGH (85-100%)**: Explicit \"must/shall/required\" language, multiple supporting excerpts, clear specifications\n- **MEDIUM (60-84%)**: Either explicit with limited detail OR well-described functionality without strict requirement language\n- **LOW (30-59%)**: Implied from workflows or standard practices, minimal direct statements\n- **VERY_LOW (<30%)**: Speculative, vague mentions without concrete requirements\n\n## Output Format - Return ONLY valid JSON (no markdown):\n\n**Important**:\n- Base confidence ONLY on provided evidence\n- For grouped requirements (e.g., \"for all entities\"), aggregate evidence from all cited sources\n- Set confidence_level as: HIGH (85-100%), MEDIUM (60-84%), LOW (30-59%), VERY_LOW (<30%)\n- Use evidence_type: \"explicit\" for must/shall/required language, \"standard\" for should/needs, \"implied\" for inferred requirements\n- Do NOT wrap output in markdown code blocks`;\n\nreturn {\n  json: {\n    systemPrompt,\n    userPrompt,\n    originalData: featuresData // Pass through for merging later\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1232,
        944
      ],
      "id": "3fe4c502-8b53-41c1-8068-732aad650b6f",
      "name": "Prepare Prompts - FN Confidence"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -1040,
        944
      ],
      "id": "01963bc4-29ad-4970-8ada-59708d4b3197",
      "name": "Get FN Confidences"
    },
    {
      "parameters": {
        "jsCode": "// n8n Function Node - Merge Features and Confidence Data\n\n// Simplified merge function for functional requirements\nfunction simpleMerge(featuresOutput, confidenceOutput) {\n  const features = featuresOutput.output.features;\n  const confidenceScores = confidenceOutput.output.confidence_scores;\n  \n  // Create a map of confidence scores by requirement title for faster lookup\n  const confidenceMap = {};\n  confidenceScores.forEach(conf => {\n    confidenceMap[conf.requirement_title] = conf;\n  });\n  \n  // Map confidence to features by title\n  const enhanced = features.map(feature => {\n    const conf = confidenceMap[feature.title];\n    \n    if (!conf) {\n      console.warn(`No confidence score found for feature: \"${feature.title}\"`);\n      return {\n        ...feature,\n        confidence_level: \"UNKNOWN\",\n        confidence_percentage: 50,\n        evidence_type: \"unknown\",\n        supporting_excerpts: [],\n        strength_rationale: \"No confidence assessment available\"\n      };\n    }\n    \n    return {\n      ...feature,\n      confidence_level: conf.confidence_level,\n      confidence_percentage: conf.confidence_percentage,\n      evidence_type: conf.evidence_assessment.evidence_type,\n      supporting_excerpts: conf.evidence_assessment.supporting_excerpts,\n      strength_rationale: conf.evidence_assessment.strength_rationale\n    };\n  });\n  \n  // Calculate summary statistics\n  const totalFeatures = enhanced.length;\n  const highConfidence = enhanced.filter(f => f.confidence_percentage >= 85);\n  const mediumConfidence = enhanced.filter(f => f.confidence_percentage >= 60 && f.confidence_percentage < 85);\n  const lowConfidence = enhanced.filter(f => f.confidence_percentage < 60);\n  \n  return {\n    output: {\n      features: enhanced,\n      highlight_data: featuresOutput.output.highlight_data || featuresOutput.output.all_highlights,\n      confidence_summary: {\n        total_features: totalFeatures,\n        high_confidence_count: highConfidence.length,\n        medium_confidence_count: mediumConfidence.length,\n        low_confidence_count: lowConfidence.length,\n        average_confidence: Math.round(\n          enhanced.reduce((sum, f) => sum + (f.confidence_percentage || 50), 0) / totalFeatures\n        ),\n        high_confidence_titles: highConfidence.map(f => f.title),\n        medium_confidence_titles: mediumConfidence.map(f => f.title),\n        low_confidence_titles: lowConfidence.map(f => f.title)\n      }\n    }\n  };\n}\n\n// Main execution\nconst featuresData = $('Parse With Citations - FN').first().json;  // First LLM output with features\nconst confidenceData = $input.first().json;  // Confidence LLM output\n\ntry {\n  const mergedResult = simpleMerge(featuresData, confidenceData);\n  \n  return {\n    json: mergedResult\n  };\n} catch (error) {\n  throw new Error(`Failed to merge features and confidence data: ${error.message}`);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -752,
        944
      ],
      "id": "cd94230e-3c6f-4b2a-9aa5-0df139efa63f",
      "name": "Map confidence to FN"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node\n * Input (first item):\n * {\n *   \"output\": {\n *     \"features\": [\n *       { \n *         \"title\": \"...\", \n *         \"description\": \"...\", \n *         \"citations\": [...],\n *         \"highlight_data\": [...],\n *         \"confidence_level\": \"...\",\n *         \"confidence_percentage\": ...,\n *         \"evidence_type\": \"...\",\n *         \"supporting_excerpts\": [...],\n *         \"strength_rationale\": \"...\"\n *       },\n *       ...\n *     ]\n *   }\n * }\n *\n * Output:\n * { featureListSnippet: '### KEY_FEATURES …' }\n */\n\nconst feat = $input.first().json.output || {};\n\n// --- Basic validation ------------------------------------------------------\nif (!Array.isArray(feat.features) || feat.features.length === 0) {\n  throw new Error('Expected non-empty output.features array from previous step.');\n}\n\n// --- Strip citations from descriptions -------------------------------------\nconst stripCitations = (text) => {\n  if (!text) return text;\n  return text\n    .replace(/\\[\\d+\\]/g, '')     // Remove citations\n    .replace(/\\s+\\./g, '.')       // Fix spaces before periods\n    .replace(/\\s+,/g, ',')        // Fix spaces before commas\n    .replace(/,\\s*\\./g, '.')      // Remove comma-period combinations\n    .replace(/\\s+/g, ' ')         // Collapse multiple spaces\n    .trim();\n};\n\n// --- Prepare simplified features for downstream use ------------------------\nconst simplifiedFeatures = feat.features.map(feature => ({\n  //feature_title: feature.feature_title,\n  item: stripCitations(feature.feature_description)\n}));\n\n// --- Build the snippet -----------------------------------------------------\nconst featureListSnippet = [\n  '### KEY_FEATURES (authoritative, extracted in a prior step)',\n  JSON.stringify(simplifiedFeatures, null, 2),\n  '',\n  'Treat this feature list as fixed functional scope for downstream sizing, sequencing, and cost estimation.',\n].join('\\n');\n\n// --- Optional: Add summary statistics -------------------------------------\nconst featureSummary = {\n  total_features: feat.features.length,\n  high_confidence_features: feat.features.filter(f => f.confidence_percentage >= 85).length,\n  medium_confidence_features: feat.features.filter(f => f.confidence_percentage >= 60 && f.confidence_percentage < 85).length,\n  low_confidence_features: feat.features.filter(f => f.confidence_percentage < 60).length,\n  average_confidence: Math.round(\n    feat.features.reduce((sum, f) => sum + (f.confidence_percentage || 0), 0) / feat.features.length\n  )\n};\n\n// --- Return for downstream use --------------------------------------------\nreturn [\n  {\n    json: {\n      featureListSnippet,\n      featureSummary,\n      features_for_analysis: simplifiedFeatures  // Clean array for other uses\n    },\n  },\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2864,
        3648
      ],
      "id": "133a9365-2936-4abd-be3a-89d898263257",
      "name": "Downstream LLM Output - FN"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node\n * Input (first item):\n * {\n *   \"output\": {\n *     \"features\": [\n *       { \"title\": \"...\", \"description\": \"...\", \"reference_section\": \"...\" },\n *       ...\n *     ]\n *   }\n * }\n *\n * Output:\n * { featureListSnippet: '### KEY_FEATURES …' }\n */\n\nconst feat = $input.first().json.output || {};\n\n// --- Basic validation ------------------------------------------------------\nif (!Array.isArray(feat.features) || feat.features.length === 0) {\n  throw new Error('Expected non-empty output.features array from previous step.');\n}\n\n// --- Build the snippet -----------------------------------------------------\nconst featureListSnippet = [\n  '### KEY_FEATURES (authoritative, extracted in a prior step)',\n  JSON.stringify(feat.features, null, 2), // pretty-printed JSON array\n  '',\n  'Treat this feature list as fixed functional scope for downstream sizing, sequencing, and cost estimation.',\n].join('\\n');\n\n// --- Return for downstream use --------------------------------------------\nreturn [\n  {\n    json: {\n      featureListSnippet,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2192,
        3904
      ],
      "id": "b813fa74-3902-4163-a862-d93d7887a213",
      "name": "Downstream LLM Output - FN1"
    },
    {
      "parameters": {
        "jsCode": "// 2. Format the context\nconst contextForPrompt = $input.first().json.context;\nconst systemPrompt = \"You are a strict JSON extractor.The user will supply raw excerpts from a software RFP that describe project scope and backlog. Identify every distinct Functional Requirement (what the system must do). Do NOT invent, merge, or omit anything.Return **only** a valid JSON array—no headings, no markdown, no extra text.\";\n// 3. Define the user prompt\nconst userPrompt = `Below are excerpts from an RFP that describe the project scope, backlog items, and milestones.\n\n\\n\\n### excerpts:\\n\\n${contextForPrompt}\n\nYour task is to extract all meaningful features and expectations and assign them to one of the following categories:\n\n- Functional Requirement (FR): What the system must do.\n\nInstructions:\n- Do not skip, combine, or summarize any features.\n- Do not refer to “the document” or mention formatting.\n- Do not include commentary, labels, headings, or markdown blocks.\n- Sort results using section numbers, ascending.\n- Do not include documentation, \n`;\n\nreturn {\n  json: {\n    userPrompt,\n    systemPrompt: systemPrompt\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3680,
        3488
      ],
      "id": "1420dae7-a5c9-4a2f-a6ec-85c0385c3c41",
      "name": "PreparePrompts - FN1"
    },
    {
      "parameters": {
        "content": "## Inference Non Functional Requirements\n\n",
        "height": 524,
        "width": 2904,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1552,
        3568
      ],
      "id": "dfeaacae-197f-4956-87ef-2a57a8a0c24e",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -800,
        3904
      ],
      "id": "414e2927-fefa-4dee-b714-1f699d191b55",
      "name": "GPT 4.1-Mini2",
      "credentials": {
        "openAiApi": {
          "id": "M8xqWvEC6mH6LNuk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"confidence_scores\": [\n    {\n      \"nfr_title\": \"text\",\n      \"confidence_level\": \"HIGH\",\n      \"confidence_percentage\": 85,\n      \"evidence_assessment\": {\n        \"evidence_type\": \"measurable\",\n        \"supporting_excerpts\": [1, 2],\n        \"strength_rationale\": \"Explanation of confidence rating\"\n      }\n    }\n  ]\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        144,
        1104
      ],
      "id": "9de37fe3-d715-4663-9257-dcada1b430bf",
      "name": "Structured Output Parser3"
    },
    {
      "parameters": {
        "jsCode": "const queries = [\n  {\n    json: {\n      query_type: \"non_functional_requirements\",\n      query:\n        \"Extract every non-functional requirement (performance, security, availability, scalability, accessibility, SEO, DevOps, monitoring, localization) described in the RFP that will influence architecture, DevOps, or QA effort.\",\n      /* NFR vocabulary */\n      keywords: [\n        /* performance & scale */\n        \"performance\", \"latency\", \"response time\", \"rps\", \"tps\",\n        \"load time\", \"web vitals\", \"core web vitals\", \"lighthouse\",\n        \"concurrency\", \"throughput\", \"scalability\", \"autoscale\",\n\n        /* availability & reliability */\n        \"uptime\", \"availability\", \"sla\", \"99.9%\", \"ha\", \"redundancy\",\n        \"failover\", \"disaster recovery\", \"rto\", \"rpo\",\n\n        /* security & privacy */\n        \"encryption\", \"tls\", \"ssl\", \"https\", \"owasp\", \"penetration test\",\n        \"vulnerability scan\", \"sso\", \"oauth\", \"saml\", \"jwt\", \"waf\",\n        \"access control\", \"role based access\", \"audit log\",\n\n        /* accessibility & seo */\n        \"wcag\", \"accessibility\", \"screen reader\", \"seo\", \"page speed\",\n        \"structured data\", \"sitemap.xml\",\n\n        /* DevOps & monitoring */\n        \"ci/cd\", \"pipeline\", \"deployment\", \"kubernetes\", \"docker\",\n        \"infrastructure as code\", \"terraform\", \"ansible\",\n        \"monitoring\", \"alerting\", \"logging\", \"grafana\", \"prometheus\",\n        \"observability\", \"sli\", \"slo\",\n\n        /* maintenance & support */\n        \"maintainability\", \"upgrade\", \"patching\", \"rollback\",\n        \"support window\", \"support hours\",\n\n          /* localisation & content scope */\n  \"localisation\", \"localization\", \"multilingual\", \"multi-language\",\n  \"translation\", \"i18n\", \"l10n\", \"languages\", \"locale\", \"page count\",\n  \"templates\", \"content migration\"\n      ],\n\n      /* Phrase boost for classic NFR language */\n      phrase: \"performance latency uptime availability security scalability localization\",\n\n      /* Rescore phrase for tight relevance */\n      rescore_query: \"performance OR uptime OR security OR scalability\",\n\n      description:\n        \"Surface all non-functional requirements that impact architecture, DevOps, security, performance, monitoring, or support.\"\n    }\n  }\n];\n\n// Return as a single item with the platforms array inside\nreturn [{\n  json: {\n    queries_embed_full_array: queries\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1088,
        3664
      ],
      "id": "8e634de4-946e-417b-bf50-b2d231407f67",
      "name": "Prepare Queries - NN"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "yBeOa0XzKuKyQKkJ",
          "mode": "list",
          "cachedResultUrl": "/workflow/yBeOa0XzKuKyQKkJ",
          "cachedResultName": "Estimation Tool - Chunk Retriever"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query_embed_for_sorting": "search_query: Extract every non-functional requirement (performance, security, availability, scalability, accessibility, SEO, DevOps, monitoring, localization) described in the RFP that will influence architecture, DevOps, or QA effort.",
            "error_title": "Non-Functional Requirements",
            "error_desc": "Unfortunately, we couldn’t identify the non-functional requirements from your RFP. Since this information is essential for the analysis, the process has been halted.",
            "index_name": "={{ $('Start RFP Analysis').item.json.body.indexName }}",
            "queries_embed_full_array": "={{ $json.queries_embed_full_array }}",
            "topic_keyword": "non_functional_requirements",
            "num_of_chunks": 12
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query_embed_for_sorting",
              "displayName": "query_embed_for_sorting",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "index_name",
              "displayName": "index_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "error_title",
              "displayName": "error_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "error_desc",
              "displayName": "error_desc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "queries_embed_full_array",
              "displayName": "queries_embed_full_array",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "array",
              "removed": false
            },
            {
              "id": "topic_keyword",
              "displayName": "topic_keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "num_of_chunks",
              "displayName": "num_of_chunks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -880,
        3664
      ],
      "id": "b155863d-4584-4b0b-8397-b1cbc029d2a6",
      "name": "NN Retrieve Chunks"
    },
    {
      "parameters": {
        "jsCode": "// 1. Gather ES-RAG context\nconst contextForPrompt = $input.first().json.context;\n\n// 2. System prompt (matches FR style)\nconst systemPrompt = `You are a strict JSON extractor. The user will supply raw excerpts from a software RFP that describe performance, security, and operational requirements. Identify every distinct Non-Functional Requirement (how the system must perform or be operated). Do NOT invent, merge, or omit anything. Return **only** a valid JSON array—no headings, no markdown, no extra text.`;\n\n// 3. User prompt (improved to match FR structure)\nconst userPrompt = `Below are excerpts from an RFP that describe performance, security, scalability, uptime, DevOps, accessibility, and other non-functional expectations.\n### excerpts:\n${contextForPrompt}\n\nYour task is to extract all non-functional requirements (NFRs) - how the system must perform or be operated.\n\nInstructions:\n- Do not skip, combine, or summarize any requirements\n- **CRITICAL: When describing requirements, ALWAYS cite your sources using [1], [2], [3], etc. based on the excerpt numbers shown above.**\n- Include citation numbers directly in the description text to show which excerpts support each requirement\n- Do not refer to \"the document\" or mention formatting\n- Do not include commentary, labels, headings, or markdown blocks\n- Sort results by section numbers, ascending\n- **Group similar requirements when they apply to the same quality attribute**\n- Example: Instead of separate \"99.9% uptime\" and \"24/7 availability\", combine as \"System availability of 99.9% uptime with 24/7 operation [3], [5]\"\n- Use these categories: Performance, Availability, Security, Scalability, Accessibility, SEO, Localization/Languages, DevOps/Deployment, Monitoring/Logging, Maintainability, Compliance\n- If Localization/Languages are not mentioned, default to \"English language support [inferred]\"\n- Do NOT include functional requirements (what the system does)\n- Maximum 100 words per requirement description\n- Each requirement must be independently understandable\n- Preserve technical specifications exactly as stated (numbers, percentages, timeframes)\n\n**Output Format - Return ONLY valid JSON:**`;\n\nreturn {\n  json: {\n    userPrompt,\n    systemPrompt\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -688,
        3664
      ],
      "id": "d1b7d3d5-d787-424c-b3b6-4367be5fc2b9",
      "name": "PreparePrompts - NN"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -496,
        3664
      ],
      "id": "4c4b620f-02c2-4f00-8b60-0306ed0dd7c1",
      "name": "Get Non-Functional Requirements"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"non_functional_requirements\": [\n    {\n      \"title\": \"Page Load Performance\",\n      \"description\": \"All pages must load within 3 seconds on standard broadband connections [1]. Initial page load and subsequent navigation should not exceed this threshold [3].\",\n      \"category\": \"Performance\"\n    },\n    {\n      \"title\": \"System Availability\",\n      \"description\": \"The system must maintain 99.9% uptime measured monthly [2]. Planned maintenance windows are excluded from uptime calculations and limited to 4 hours monthly [5].\",\n      \"category\": \"Availability\"\n    },\n    {\n      \"title\": \"HTTPS Encryption\",\n      \"description\": \"All data transmission must use HTTPS/TLS 1.3 encryption [4]. HTTP requests must automatically redirect to HTTPS [6].\",\n      \"category\": \"Security\"\n    },\n    {\n      \"title\": \"Concurrent User Support\",\n      \"description\": \"The system must support minimum 500 concurrent users without performance degradation [7]. Load testing must demonstrate handling 1000 concurrent users at peak [8].\",\n      \"category\": \"Scalability\"\n    },\n    {\n      \"title\": \"WCAG Compliance\",\n      \"description\": \"The interface must meet WCAG 2.1 Level AA accessibility standards [9]. All interactive elements must be keyboard navigable and screen reader compatible [10].\",\n      \"category\": \"Accessibility\"\n    },\n    {\n      \"title\": \"Multi-language Support\",\n      \"description\": \"The system must support Croatian and English languages [11]. Language switching must be available on all pages without data loss [12].\",\n      \"category\": \"Localization/Languages\"\n    }\n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -256,
        3872
      ],
      "id": "dc6a3283-fbdb-4e64-8543-d4b07cc9ed0e",
      "name": "NN"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node - Parse Functional Requirements with Full Traceability\n */\nconst llmResponse = $input.first().json.output;\nconst referenceMap = $('NN Retrieve Chunks').first().json.reference_map;\nconst originalChunks = $('NN Retrieve Chunks').first().json.original_chunks;\n\n// Extract unique cited references from ALL feature descriptions\nconst allDescriptions = llmResponse.non_functional_requirements.map(f => f.description).join(' ');\nconst citedRefMatches = allDescriptions.match(/\\[(\\d+)\\]/g) || [];\nconst uniqueRefNumbers = [...new Set(citedRefMatches.map(ref => \n  parseInt(ref.replace(/[\\[\\]]/g, ''))\n))];\n\n// Build deduplicated highlight data with text\nconst highlights = [];\nconst seen = new Set();\n\nuniqueRefNumbers.forEach(refNum => {\n  const chunk = referenceMap.find(r => r.ref_number === refNum);\n  const originalChunk = originalChunks[refNum - 1]; // Get original chunk text\n  \n  if (chunk && originalChunk) {\n    chunk.bboxes.forEach(bbox => {\n      const key = `${bbox.page_no}_${chunk.chunk_id}_${bbox.bbox.l}_${bbox.bbox.t}`;\n      \n      if (!seen.has(key)) {\n        seen.add(key);\n        highlights.push({\n          ref_number: refNum,\n          chunk_id: chunk.chunk_id,\n          page: bbox.page_no,\n          coordinates: bbox.bbox,\n          text: originalChunk.text,  // Add full chunk text\n          text_preview: originalChunk.text.substring(0, 200) + \"...\"  // Short preview\n        });\n      }\n    });\n  }\n});\n\n// Add citation mapping to each feature (which chunks support this feature)\nconst featuresWithCitations = llmResponse.non_functional_requirements.map(feature => {\n  // Extract citation numbers from this feature's description\n  const featureCitations = (feature.description.match(/\\[(\\d+)\\]/g) || [])\n    .map(ref => parseInt(ref.replace(/[\\[\\]]/g, '')));\n  \n  // Get the highlight data for these citations\n  const featureHighlights = highlights.filter(h => \n    featureCitations.includes(h.ref_number)\n  );\n  \n  return {\n    ...feature,\n    citations: featureCitations,\n    highlight_data: featureHighlights\n  };\n});\n\n// Return with complete traceability\nreturn [{\n  json: {\n    output: {\n      features: featuresWithCitations,\n      all_highlights: highlights, // All highlights across all features\n      summary: {\n        total_features: featuresWithCitations.length,\n        total_citations: uniqueRefNumbers.length,\n        total_highlights: highlights.length\n      }\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        3664
      ],
      "id": "3c25ac90-2e6d-4c7b-a047-62740fc69573",
      "name": "Parse With Citations - NN"
    },
    {
      "parameters": {
        "jsCode": "// n8n Function Node - Prepare Confidence Scoring for Non-Functional Requirements\nconst nfrData = $input.first().json.output;\nconst nfrs = nfrData.features || nfrData.nfrs;\nconst allHighlights = nfrData.all_highlights;\n\n// Build excerpt reference map from all highlights (excluding bbox for prompt)\nconst excerptMap = {};\nallHighlights.forEach(item => {\n  excerptMap[item.ref_number] = {\n    chunk_id: item.chunk_id,\n    text: item.text,\n    page: item.page\n    // NOTE: Keeping coordinates in data but NOT in prompt\n  };\n});\n\nconst systemPrompt = `You are a precision analyst that evaluates the strength of evidence for non-functional requirements extraction. You assess confidence based on explicit performance/quality statements, measurability, and specificity of constraints. Return your analysis as structured JSON.`;\n\nconst userPrompt = `Analyze the confidence level for each non-functional requirement based on the provided evidence.\n\n## Identified Non-Functional Requirements:\n${JSON.stringify(nfrs.map(nfr => ({\n  title: nfr.title,\n  description: nfr.description,\n  category: nfr.category,\n  citations: nfr.citations\n})), null, 2)}\n\n## Referenced Excerpts:\n${allHighlights.map(h => `[${h.ref_number}]: \"${h.text.substring(0, 400)}...\" (Page ${h.page})`).join('\\n\\n')}\n\n## Task:\nFor EACH non-functional requirement listed above, provide a confidence assessment.\n\n## Evaluation Criteria:\n1. **Requirement Specificity**:\n   - **Measurable**: Includes specific metrics, thresholds, or values (e.g., \"99.9% uptime\", \"< 3 seconds\")\n   - **Qualitative**: Uses descriptive standards without metrics (e.g., \"must be secure\", \"should be fast\")\n   - **Vague**: General expectations without clear criteria\n\n2. **Language Strength**:\n   - **Mandatory**: Uses \"must\", \"shall\", \"required\", \"critical\"\n   - **Recommended**: Uses \"should\", \"recommended\", \"preferred\"\n   - **Optional**: Uses \"may\", \"could\", \"nice to have\"\n\n3. **Evidence Quality**:\n   - Multiple excerpts with consistent requirements\n   - Technical specifications vs. general statements\n   - Industry standards referenced (e.g., \"WCAG 2.1\", \"ISO 27001\")\n\n## Confidence Scale:\n- **HIGH (85-100%)**: Measurable requirements with \"must/shall\" language, specific thresholds or standards\n- **MEDIUM (60-84%)**: Clear requirements with either metrics OR mandatory language (not both)\n- **LOW (30-59%)**: General quality expectations without specific criteria\n- **VERY_LOW (<30%)**: Vague mentions or inferred from context\n\n## Output Format - Return ONLY valid JSON (no markdown):\n\n**Important**:\n- Base confidence ONLY on provided evidence\n- Higher confidence for measurable NFRs (response time, uptime %, user counts)\n- Lower confidence for subjective NFRs (\"user-friendly\", \"modern\", \"scalable\")\n- Do NOT wrap output in markdown code blocks`;\n\nreturn {\n  json: {\n    systemPrompt,\n    userPrompt,\n    originalData: nfrData // Pass through for merging later\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -304,
        880
      ],
      "id": "0adfdeb8-f427-41a0-9b00-6d5e42c5edbb",
      "name": "Prepare Prompts - NN Confidence"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -112,
        880
      ],
      "id": "7db1281f-de31-4551-ac70-46f8a91fd24b",
      "name": "Get NN Confidences"
    },
    {
      "parameters": {
        "jsCode": "// n8n Function Node - Merge Features and Confidence Data\n\n// Simplified merge function for functional requirements\nfunction simpleMerge(featuresOutput, confidenceOutput) {\n  const features = featuresOutput.output.features;\n  const confidenceScores = confidenceOutput.output.confidence_scores;\n  \n  // Create a map of confidence scores by requirement title for faster lookup\n  const confidenceMap = {};\n  confidenceScores.forEach(conf => {\n    confidenceMap[conf.nfr_title] = conf;\n  });\n  \n  // Map confidence to features by title\n  const enhanced = features.map(feature => {\n    const conf = confidenceMap[feature.title];\n    \n    if (!conf) {\n      console.warn(`No confidence score found for feature: \"${feature.title}\"`);\n      return {\n        ...feature,\n        confidence_level: \"UNKNOWN\",\n        confidence_percentage: 50,\n        evidence_type: \"unknown\",\n        supporting_excerpts: [],\n        strength_rationale: \"No confidence assessment available\"\n      };\n    }\n    \n    return {\n      ...feature,\n      confidence_level: conf.confidence_level,\n      confidence_percentage: conf.confidence_percentage,\n      evidence_type: conf.evidence_assessment.evidence_type,\n      supporting_excerpts: conf.evidence_assessment.supporting_excerpts,\n      strength_rationale: conf.evidence_assessment.strength_rationale\n    };\n  });\n  \n  // Calculate summary statistics\n  const totalFeatures = enhanced.length;\n  const highConfidence = enhanced.filter(f => f.confidence_percentage >= 85);\n  const mediumConfidence = enhanced.filter(f => f.confidence_percentage >= 60 && f.confidence_percentage < 85);\n  const lowConfidence = enhanced.filter(f => f.confidence_percentage < 60);\n  \n  return {\n    output: {\n      features: enhanced,\n      highlight_data: featuresOutput.output.highlight_data || featuresOutput.output.all_highlights,\n      confidence_summary: {\n        total_features: totalFeatures,\n        high_confidence_count: highConfidence.length,\n        medium_confidence_count: mediumConfidence.length,\n        low_confidence_count: lowConfidence.length,\n        average_confidence: Math.round(\n          enhanced.reduce((sum, f) => sum + (f.confidence_percentage || 50), 0) / totalFeatures\n        ),\n        high_confidence_titles: highConfidence.map(f => f.title),\n        medium_confidence_titles: mediumConfidence.map(f => f.title),\n        low_confidence_titles: lowConfidence.map(f => f.title)\n      }\n    }\n  };\n}\n\n// Main execution\nconst featuresData = $('Parse With Citations - NN').first().json;  // First LLM output with features\nconst confidenceData = $input.first().json;  // Confidence LLM output\n\ntry {\n  const mergedResult = simpleMerge(featuresData, confidenceData);\n  \n  return {\n    json: mergedResult\n  };\n} catch (error) {\n  throw new Error(`Failed to merge features and confidence data: ${error.message}`);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        176,
        880
      ],
      "id": "b10b9d7a-87a5-49b7-b2be-782a768c7c9f",
      "name": "Map confidence to NN"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node\n * Input (first item):\n * {\n *   \"output\": {\n *     \"non_functional_requirements\": [\n *       { \n *         \"title\": \"...\", \n *         \"description\": \"...\", \n *         \"category\": \"...\",\n *         \"citations\": [...],\n *         \"highlight_data\": [...],\n *         \"confidence_level\": \"...\",\n *         \"confidence_percentage\": ...,\n *         \"evidence_type\": \"...\",\n *         \"supporting_excerpts\": [...],\n *         \"strength_rationale\": \"...\"\n *       },\n *       ...\n *     ]\n *   }\n * }\n *\n * Output:\n * { nfrListSnippet: '### NON_FUNCTIONAL_REQUIREMENTS …' }\n */\n\nconst nfrData = $input.first().json.output || {};\n\n// --- Basic validation ------------------------------------------------------\nif (!Array.isArray(nfrData.features) || nfrData.features.length === 0) {\n  throw new Error('Expected non-empty output.non_functional_requirements array from previous step.');\n}\n\n// --- Strip citations from descriptions -------------------------------------\nconst stripCitations = (text) => {\n  if (!text) return text;\n  return text\n    .replace(/\\[\\d+\\]/g, '')     // Remove citations\n    .replace(/\\s+\\./g, '.')       // Fix spaces before periods\n    .replace(/\\s+,/g, ',')        // Fix spaces before commas\n    .replace(/,\\s*\\./g, '.')      // Remove comma-period combinations\n    .replace(/\\s+/g, ' ')         // Collapse multiple spaces\n    .trim();\n};\n\n// --- Prepare simplified NFRs for downstream use ------------------------\nconst simplifiedNFRs = nfrData.features.map(nfr => ({\n  //title: nfr.title,\n  item: stripCitations(nfr.description),\n  category: nfr.category  // Include category for NFRs as it's important\n}));\n\n// --- Build the snippet -----------------------------------------------------\nconst nfrListSnippet = [\n  '### NON_FUNCTIONAL_REQUIREMENTS (authoritative, extracted in a prior step)',\n  JSON.stringify(simplifiedNFRs, null, 2),\n  '',\n  'Treat this NFR list as fixed quality/performance constraints for downstream architecture, infrastructure, and technology decisions.',\n].join('\\n');\n\n// --- Optional: Add summary statistics -------------------------------------\nconst nfrSummary = {\n  total_nfrs: nfrData.features.length,\n  high_confidence_nfrs: nfrData.features.filter(n => n.confidence_percentage >= 85).length,\n  medium_confidence_nfrs: nfrData.features.filter(n => n.confidence_percentage >= 60 && n.confidence_percentage < 85).length,\n  low_confidence_nfrs: nfrData.features.filter(n => n.confidence_percentage < 60).length,\n  average_confidence: Math.round(\n    nfrData.features.reduce((sum, n) => sum + (n.confidence_percentage || 0), 0) / nfrData.features.length\n  ),\n  // NFR-specific: Category breakdown\n  categories_found: [...new Set(nfrData.features.map(n => n.category))],\n  category_counts: nfrData.features.reduce((acc, n) => {\n    acc[n.category] = (acc[n.category] || 0) + 1;\n    return acc;\n  }, {})\n};\n\n// --- Return for downstream use --------------------------------------------\nreturn [\n  {\n    json: {\n      nfrListSnippet,\n      nfrSummary,\n      nfrs_for_analysis: simplifiedNFRs  // Clean array for other uses\n    },\n  },\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        944,
        3904
      ],
      "id": "7ea985a5-0d57-44b4-81b6-a4cc370262dd",
      "name": "Downstream LLM Output - NN"
    },
    {
      "parameters": {
        "content": "Techstack\n\n",
        "height": 524,
        "width": 2904,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4560,
        5040
      ],
      "id": "f984abd0-9aa3-467e-a98c-08adbb2f80c0",
      "name": "Sticky Note8"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        -3392,
        5360
      ],
      "id": "3eebd2d6-92d1-4937-9f8d-54b5a4c33d61",
      "name": "Think6"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {
          "maxTokens": 9000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -3936,
        5360
      ],
      "id": "ae813a7f-9def-4239-8e80-b63b7f14e538",
      "name": "GPT 4.1-Mini3",
      "credentials": {
        "openAiApi": {
          "id": "M8xqWvEC6mH6LNuk",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const queries = [\n  {\n    json: {\n      key: \"web_stack\",\n      query: \"What frontend or web frameworks are mentioned?\",\n      keywords: \"React, Angular, Vue, Svelte, Next.js, Nuxt.js, web framework, frontend, front-end, web app, web application, JavaScript, TypeScript, HTML, CSS\",\n      phrase: \"frontend web application\",\n      rescore_query: \"React OR Angular OR Vue OR Next.js\"\n    }\n  },\n  {\n    json: {\n      key: \"design\",\n      query: \"What design system or UI components are referenced?\",\n      keywords: \"Shadcn, Tailwind, Bootstrap, Material UI, design system, UI kit, style guide, branding, UX, Figma, wireframes, visual design, WCAG, Radix, Ant Design\",\n      phrase: \"design system UI kit\",\n      rescore_query: \"Shadcn OR Material UI OR Tailwind\"\n    }\n  },\n  {\n    json: {\n      key: \"mobile_stack\",\n      query: \"What mobile development technologies are mentioned?\",\n      keywords: \"Flutter, React Native, Swift, Kotlin, iOS, Android, mobile app, mobile development, native mobile, cupertino\",\n      phrase: \"mobile development mobile app\",\n      rescore_query: \"Flutter OR React Native OR Kotlin OR Swift\"\n    }\n  },\n  {\n    json: {\n      key: \"backend_stack\",\n      query: \"What backend technologies or server frameworks are used?\",\n      keywords: \"Node.js, Python, Django, Java, Spring, PHP, Laravel, Ruby, Rails, Express, .NET, API, backend server, server-side, Go, Rust, FastAPI, NestJS\",\n      phrase: \"backend server backend technology\",\n      rescore_query: \"Node.js OR Django OR Laravel OR Java OR Spring\"\n    }\n  },\n  {\n    json: {\n      key: \"ai_needed\",\n      query: \"Does the project involve AI, ML, or data processing?\",\n      keywords: \"AI, artificial intelligence, machine learning, ML, chatbot, NLP, LLM, model training, predictive analytics, smart assistant, automation, algorithm, TensorFlow, PyTorch, OpenAI, Azure AI\",\n      phrase: \"AI functionality ML features\",\n      rescore_query: \"AI OR ML OR LLM OR chatbot\"\n    }\n  },\n  {\n    json: {\n      key: \"database\",\n      query: \"What kind of database or data storage is required?\",\n      keywords: \"PostgreSQL, MySQL, MongoDB, Redis, database, data storage, data layer, NoSQL, SQL, relational database, DBMS, backend storage, SQL Server, Oracle, DynamoDB, Firebase\",\n      phrase: \"data storage database\",\n      rescore_query: \"PostgreSQL OR MongoDB OR database system\"\n    }\n  },\n  {\n    json: {\n      key: \"deployment\",\n      query: \"Where is the system hosted or deployed?\",\n      keywords: \"AWS, Azure, GCP, cloud hosting, on-premises, hybrid, deployment, infrastructure, Kubernetes, Docker, container, server, on-premise, self-hosted, serverless, Kubernetes\",\n      phrase: \"deployment infrastructure hosting\",\n      rescore_query: \"AWS OR Azure OR cloud hosting\"\n    }\n  },\n  {\n    json: {\n      key: \"integrations\",\n      query: \"What external systems, APIs, or services need to be integrated?\",\n      keywords: \"integration, OAuth, SAML, API, APIs, third-party service, external system, SSO, payment gateway, Stripe, REST API, GraphQL, CRM, ERP\",\n      phrase: \"integration third-party system\",\n      rescore_query: \"OAuth OR API OR SSO OR Stripe\"\n    }\n  }\n];\n\n// Return as a single item with the platforms array inside\nreturn [{\n  json: {\n    queries_embed_full_array: queries\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4096,
        5136
      ],
      "id": "e109f2cb-c960-4829-9bd0-a689eee493bf",
      "name": "Prepare Queries - Techstack"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "yBeOa0XzKuKyQKkJ",
          "mode": "list",
          "cachedResultUrl": "/workflow/yBeOa0XzKuKyQKkJ",
          "cachedResultName": "Estimation Tool - Chunk Retriever"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query_embed_for_sorting": "search_query: What is the recommended technology stack, frameworks, programming languages, and technical architecture for this project?",
            "error_title": "Techstack",
            "error_desc": "Unfortunately, we couldn’t identify the techstack from your RFP. Since this information is essential for the analysis, the process has been halted.",
            "index_name": "={{ $('Start RFP Analysis').item.json.body.indexName }}",
            "queries_embed_full_array": "={{ $json.queries_embed_full_array }}",
            "topic_keyword": "techstack",
            "num_of_chunks": 5
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "query_embed_for_sorting",
              "displayName": "query_embed_for_sorting",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "index_name",
              "displayName": "index_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "error_title",
              "displayName": "error_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "error_desc",
              "displayName": "error_desc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "queries_embed_full_array",
              "displayName": "queries_embed_full_array",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "array",
              "removed": false
            },
            {
              "id": "topic_keyword",
              "displayName": "topic_keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "num_of_chunks",
              "displayName": "num_of_chunks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -3888,
        5136
      ],
      "id": "1d200127-07c0-46fe-9da7-f33cf44f7a45",
      "name": "Techstack Retrieve Chunks"
    },
    {
      "parameters": {
        "jsCode": "// ---------------------------------------------------------------------------\n// gather snippets\n// ---------------------------------------------------------------------------\nconst ctxChunks = $input.first().json.context || \"\";;\nconst platforms = $('Downstream LLM Output - Platforms').first().json.detectedPlatformsSnippet;\nconst requirements  = $('Combined Requirements Output').first().json.combinedRequirementsSnippet;\n\n// ---------------------------------------------------------------------------\n// system prompt\n// ---------------------------------------------------------------------------\nconst systemPrompt = `\nYou are a senior solution-architect.\nReturn ONLY a valid JSON object under the key \"tech_stack\".\nDo NOT output headings, markdown, or commentary.\n`;\n\nconst userPrompt = `\nYou are analysing RFP excerpts to define the optimal technology stack.\n\n### CONTEXT\n${ctxChunks}\n${platforms}\n${requirements}\n\n### TASK\nBuild a tech_stack JSON object following these rules:\n\n**CRITICAL**: \n- Only populate technologies for platforms listed in DETECTED_PLATFORMS. Leave others empty.\n- When referencing information from the context chunks, ALWAYS cite your sources using [1], [2], [3], etc. based on the chunk numbers provided.\n\n### DECISION HIERARCHY\n\n1. **Explicit Requirements** (Highest Priority)\n   Use technologies explicitly named in the RFP with citations [N].\n\n2. **AI-Generated Shortcut**\n   IF all conditions met:\n   - No explicit tech requirements in chunks\n   - Simple CRUD + admin UI only (cite chunks showing this)\n   - No custom design needs\n   \n   THEN use:\n   - web_stack: \"Next.js\"\n   - backend_stack: \"Supabase\"  \n   - database: \"Supabase\"\n   - design: \"Shadcn\"\n   - stack_model: \"fullstack\"\n   - Start rationale with \"**Heavily AI-generated:**\"\n\n3. **Implicit Requirements**\n   Technologies implied by context (e.g., WordPress [N] → PHP + MySQL)\n\n4. **House Defaults** (Lowest Priority)\n   When no requirements found in chunks [1-N]:\n   - web_stack: \"React\"\n   - backend_stack: \"PHP Symfony\"\n   - mobile_stack: \"Flutter\"\n   - design: \"Shadcn\"\n   - database: \"PostgreSQL\"\n   - deployment: \"AWS\"\n\n### DOMAIN HEURISTICS\nApply when no explicit/implicit requirements, citing relevant chunks:\n\n**Finance/Compliance** [N]: Java Spring Boot, enhanced security\n**Government** [N]: AWS GovCloud or Azure Government, .NET or Java\n**E-commerce** [N]: Node.js/PHP Laravel, Stripe, Cloudflare CDN\n**Real-time** [N]: Node.js or Go, Redis cache\n**EU Data** [N]: AWS (eu-central-1)\n**Video/Streaming** [N]: AWS MediaConvert, Redis cache\n**Multi-language** [N]: i18next integration\n**High availability (99.9% uptime)** [N]: Include monitoring (Prometheus, Grafana)\n**WCAG compliance** [N]: Material UI for design system\n\n### OUTPUT REQUIREMENTS: JSON\n\n### RATIONALE FORMAT\n- Start with: **Extracted:**, **Inferred:**, or **Heavily AI-generated:**\n- Include citations: \"Based on requirements in [3] and [5]...\"\n- Use markdown: **bold**, ## headers, - bullets, \\`code\\`\n- Reference specific chunks when explaining decisions\n- Example: \"The RFP explicitly mentions 'React framework' in [2], and requires 'PostgreSQL database' in [4]\"\n\n### CITATION EXAMPLES\n- \"Security requirements in [1] suggest enterprise-grade backend\"\n- \"CRUD operations described in [5], [6] indicate standard admin panel\"\n- \"No specific tech mentioned in chunks [1-7], applying house defaults\"\n- \"Performance requirements 'under 3 seconds' in [3] supports Next.js selection\"\n`;\n\nreturn { json: { systemPrompt, userPrompt } };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3696,
        5136
      ],
      "id": "c1c3a970-edfe-45d0-b1a6-3bb9aac5ebe2",
      "name": "PreparePrompts - Techstack"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userPrompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "={{ $json.systemPrompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -3504,
        5136
      ],
      "id": "d2e532f4-2b45-4cf2-8ef8-a7372939ba5d",
      "name": "Get Techstack2"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"tech_stack\": {\n    \"stack_model\": \"fullstack\",\n    \"backend_stack\": [\"Node.js\", \"Java\", \"Python\"],\n    \"web_stack\": [\"React\", \"Vue\", \"Angular\"],\n    \"mobile_stack\": [\"Flutter\", \"Swift\", \"Kotlin\"],\n    \"design\": [\"Shadcn\", \"Material UI\", \"Custom\"],\n    \"ai_needed\": true,\n    \"database\": \"PostgreSQL\",\n    \"deployment\": \"cloud\",\n    \"integrations\": [\"OAuth\", \"SAML\", \"third-party APIs\"],\n    \"rationale\": \"Why this tech stack is appropriate for this project [1]\"\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -3264,
        5344
      ],
      "id": "1667bd5a-6ce2-4d09-b2f3-5c5835fc17ac",
      "name": "Techstack"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node - Parse LLM Response with Full Traceability\n */\nconst llmResponse = $input.first().json.output;\nconst referenceMap = $('Techstack Retrieve Chunks').first().json.reference_map;\nconst originalChunks = $('Techstack Retrieve Chunks').first().json.original_chunks;\n\n// Extract unique cited references from rationale\nconst rationale = llmResponse.tech_stack.rationale || \"\";\nconst citedRefMatches = rationale.match(/\\[(\\d+)\\]/g) || [];\nconst uniqueRefNumbers = [...new Set(citedRefMatches.map(ref => \n  parseInt(ref.replace(/[\\[\\]]/g, ''))\n))];\n\n// Build deduplicated highlight data with text\nconst highlights = [];\nconst seen = new Set();\n\nuniqueRefNumbers.forEach(refNum => {\n  const chunk = referenceMap.find(r => r.ref_number === refNum);\n  const originalChunk = originalChunks[refNum - 1]; // Get original chunk text\n  \n  if (chunk && originalChunk) {\n    chunk.bboxes.forEach(bbox => {\n      const key = `${bbox.page_no}_${chunk.chunk_id}_${bbox.bbox.l}_${bbox.bbox.t}`;\n      \n      if (!seen.has(key)) {\n        seen.add(key);\n        highlights.push({\n          ref_number: refNum,\n          chunk_id: chunk.chunk_id,\n          page: bbox.page_no,\n          coordinates: bbox.bbox,\n          text: originalChunk.text,  // Add full chunk text\n          text_preview: originalChunk.text.substring(0, 200) + \"...\"  // Short preview\n        });\n      }\n    });\n  }\n});\n\n// Return with complete traceability\nreturn [{\n  json: {\n    output: {\n    techstack: llmResponse.tech_stack,\n    highlight_data: highlights\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3168,
        5136
      ],
      "id": "9d71cd59-2381-4e38-83c3-7f47bec29b39",
      "name": "Parse With Citations - Techstack"
    },
    {
      "parameters": {
        "jsCode": "// Get the output from the Combined Requirements Output node\nconst techstack = $('Get Techstack2').first().json.output;\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\nconst payload = {\n  step: \"techstack\",\n  title: \"Step 4. Techstack\",\n  sessionId: sessionId,\n  output: JSON.stringify(techstack)\n};\n\nreturn [{\n  json: payload\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2768,
        5136
      ],
      "id": "7da77b72-d6bb-498d-bcb2-270d37585600",
      "name": "Prepare for frontend14"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sse-estimation-tool.onrender.com/progress",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ $json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2592,
        5328
      ],
      "id": "edc512a1-b124-4b78-b39a-7c724343152a",
      "name": "SSE - Techstack1"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function node\n * Input  : first item from the previous “tech-stack agent” node\n *          {\n *            output: {\n *              tech_stack: { ... }\n *            }\n *          }\n * Output : { detectedTechStackSnippet: '### DETECTED_TECH_STACK …' }\n */\n\nconst { techstack } = $input.first().json.output || {};\n\n// --- Sanity check ----------------------------------------------------------\nif (!techstack || typeof techstack !== 'object') {\n  throw new Error('Expected output.tech_stack object from previous step.');\n}\n\n// --- Build the snippet -----------------------------------------------------\nconst detectedTechStackSnippet = [\n  '### DETECTED_TECH_STACK (authoritative, extracted in a prior step)',\n  JSON.stringify(techstack, null, 2),  // pretty-printed JSON\n  '',\n  'Treat this \"tech_stack\" as the baseline when refining or merging technology recommendations in the next step.',\n].join('\\n');\n\n// --- Return for the next node ---------------------------------------------\nreturn [\n  {\n    json: {\n      detectedTechStackSnippet,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2976,
        5136
      ],
      "id": "970a12e0-7802-4e40-81ce-5d0d40fd03aa",
      "name": "Techstack Output1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3664,
        5344
      ],
      "id": "6e62427a-1dba-457c-97d0-9ffa276def47",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "405i02YoCznHTji7",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001",
          "mode": "list",
          "cachedResultName": "Claude Haiku 4.5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -640,
        3872
      ],
      "id": "925b8a05-b962-454c-8bf6-3a8e8ccc99b2",
      "name": "Anthropic Chat Model6",
      "credentials": {
        "anthropicApi": {
          "id": "BVejEoXr4J9auxgo",
          "name": "Anthropic account 2"
        }
      }
    },
    {
      "parameters": {
        "content": "## confidency \n",
        "height": 784,
        "width": 1968
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1360,
        672
      ],
      "id": "1dbe25e0-4626-41f9-b8f2-74e548585acb",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "jsCode": "\nconst outputs = $('Map confidence to platforms').all().map(item => item.json.output);\nconst sessionId = $('Start RFP Analysis').first().json.body.sessionId || \"no-session\";\n\nconst payload = {\n  step: \"platforms\",\n  title: \"Step 2. Platforms Info\",\n  sessionId:sessionId,\n  output: JSON.stringify(outputs ?? {}),\n};\n\nreturn [\n  {\n    json: {\n      platforms: JSON.stringify(payload)\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -80,
        1232
      ],
      "id": "830f23be-b5a1-4d16-9ae8-82707baf3b6e",
      "name": "Prepare for frontend - Platforms1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001",
          "mode": "list",
          "cachedResultName": "Claude Haiku 4.5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -3536,
        5344
      ],
      "id": "206d88e3-9143-4f80-9318-ddda75bc7079",
      "name": "Anthropic Chat Model1",
      "credentials": {
        "anthropicApi": {
          "id": "BVejEoXr4J9auxgo",
          "name": "Anthropic account 2"
        }
      }
    }
  ],
  "pinData": {
    "Code": [
      {
        "json": {
          "systemPrompt": "You are a senior delivery manager who produces concise team-composition plans for software projects. Merge the fixed project constraints below with standard Agile delivery practice. Output **only** a valid JSON object under the key \"team_plan\".",
          "userPrompt": "\nONLY output the JSON object—no other text.\n\n### CONTEXT_SNIPPETS\n\n### DETECTED_TECH_STACK (authoritative, extracted in a prior step)\n{\n  \"stack_model\": \"fullstack\",\n  \"backend_stack\": [\n    \"Supabase\"\n  ],\n  \"web_stack\": [\n    \"Next.js\"\n  ],\n  \"mobile_stack\": [],\n  \"design\": [\n    \"Shadcn\"\n  ],\n  \"ai_needed\": false,\n  \"database\": \"Supabase\",\n  \"deployment\": \"\",\n  \"integrations\": [],\n  \"rationale\": \"**Heavily AI-generated:**\\n- The project is a simple web-based Admin Dashboard for CRUD operations, with no explicit tech stack mentioned [1], [2], [3].\\n- Requirements specify rapid development, maintainability, and security for a simple project with browser compatibility and ease of use for non-technical staff [1], [4].\\n- The project scope and non-functional requirements align with typical CRUD admin apps suitable for a modern fullstack approach.\\n- Following the AI-generated shortcut for simple CRUD+admin UI projects with no custom design needs, this stack uses:\\n  - Next.js for frontend due to React-based flexibility and speed.\\n  - Supabase for backend and database for fast deployment and integrated security.\\n  - Shadcn design system for quick UI development.\\n- No mobile app or explicit deployment requirements provided, so those remain empty.\\n- This approach meets all key platform needs (Web app, Backend API, Admin portal) and aligns with expectations stated in the RFP [1], [4].\"\n}\n\nTreat this \"tech_stack\" as the baseline when refining or merging technology recommendations in the next step.\n\n### DETECTED_PLATFORMS (authoritative, extracted in a prior step)\n{\n  \"platforms\": [\n    {\n      \"enum\": \"WEB\",\n      \"text\": \"Web application\"\n    },\n    {\n      \"enum\": \"BACKEND_API\",\n      \"text\": \"Backend/API services\"\n    },\n    {\n      \"enum\": \"ADMIN_PORTAL\",\n      \"text\": \"Admin portal/dashboard\"\n    }\n  ],\n  \"rationale\": \"## Platform Identified ### Web Application - The project is explicitly described as a \\\"web-based Admin Dashboard\\\" indicating a web application front end . - Browser compatibility requirements with major web browsers (Chrome, Firefox, Edge, Safari) further confirm the web platform . ### Backend/API Services - Secure user authentication and authorization are required, which typically necessitates backend services for security and session management . - Although not explicitly stated, since a web frontend is described, a backend is implicitly required to support CRUD operations and user management . ### Admin Portal/Dashboard - The system is described as an \\\"Admin Dashboard\\\" for internal users managing core business data with CRUD functionality, implying an administrative portal . - Usability requirements for non-technical admin staff support the necessity for an admin interface . These platform requirements and rationales are all grounded explicitly on the RFP excerpts provided.\"\n}\n\nYou must treat the array in \"platforms\" as ground truth when selecting or defaulting technologies.\n\n### TASK\nDefine the delivery roles needed to execute this project in line with the timeline and constraints.\nDo **not** estimate sprints, person-days, rates, or buffers—those will be calculated later.\nJust list each role, its seniority (e.g. Mid, Senior, Principal), and the average full-time-equivalent (FTE) allocation over the core delivery period.\n\n### DEFAULT & FALLBACK RULES\n\n-  Platform-driven roles:\n  • \"Web applications\" ⇒ Frontend Developer (React, Next.js)\n  • \"Mobile apps\" ⇒ Mobile Developer (Flutter by default; Swift/Kotlin if native)\n  • \"Admin portal\" ⇒ Frontend Developer with design system experience (Shadcn, Material UI)\n  • \"Backend/API services\" ⇒ Backend Developer (PHP Symfony, Node.js, or inferred)\n  • \"CMS\" or content-heavy site ⇒ CMS Developer or Content Specialist\n\nBy default add 1 Solution Arhitect at 30% -  depending on the complexity.\n\nBy default we have 1 project manager and 1 business analyst.\nIf the project is not too complex, use one Hybrid role (50% Project Manager and 50% Business Analyst) - Called: Product Manager.\n\n-  If compliance is \"Moderately Regulated\" or stricter:\n  • Add 1 QA Engineer minimum but in 30%\n  • Mention security-aware development practices in rationale\n  If compliance is \"Highly Regulated\":\n  add 1 QA at 50%\n\n-  If deployment seems classic (implicit or explicit):\n  • Add DevOps Engineer at 25% - if its complicated then add it at 50%\n\n-  If mobile apps required:\n  • Prefer Flutter unless RFP clearly prefers native (then Swift/Kotlin)\nIf Flutter, use 1 Flutter developer.\nIf iOS & Android, user 1 for each.\n\n-  If analytics, SEO, or tracking required:\n  • Include Analytics Specialist or Web Analyst at 30%\n\n-  If project includes “training”, “handover”, or “documentation”:\n  • Add Knowledge Transfer Lead or Documentation Specialist\n\n-  If delivery_model is “Full launch”:\n  • Treat it as a single delivery phase\n\n-  If MVP, phased delivery, or iterations mentioned:\n  • Scale team accordingly across delivery periods if needed\n\n-  If functional scope is large or complex (based on feature count or diversity):\n  • Increase number of developers or FTE allocation\n\n  -  If time line is tight:\n  • Increase number of developers or FTE allocation\n\n-  If 3rd party integrations like CRM, ERP, SSO, Stripe, etc. are required:\n  • Add some percentage to Solution Arhitect \n\n  If development aproach would be Heavily AI Generated code with Shadcn:\n  Don't add Designers. Add just one 100% NodeJS developer for development.\n  If Design is custom or if the project needs it, put 1 Designer at about 30%.\n\n  If the project needs AI, add 1 AI Engineer and, if data preparation is needed, add 1 Data Engineer.\n\n  If any requirement mentions login, authentication, payments, user roles, or GDPR, consider adding 10% to QA Engineer or Solution Architect FTE for security tasks.\n\n-  Rationale must:\n  • Start with **Extracted:**, **Inferred:**, or **Defaulted:**\n  • Be ≤ 200 words\n  • Mention platform/stack mapping to skills\n  • Justify any specialized roles added\n  **IMPORTANT: Format the rationale field using markdown markup for better readability:**\n- Use **bold text** for key points and important terms\n- Use ## headers for main sections\n- Use ### subheaders for subsections  \n- Use bullet points (- item) for lists\n- Use numbered lists (1. item) for sequential steps\n- Use \"code\" formatting for technical terms\n- Structure the rationale with clear sections and hierarchy\n\nONLY output the JSON object—no other text.\n"
        }
      }
    ],
    "Start RFP Analysis": [
      {
        "json": {
          "headers": {
            "host": "infinite-wasp-terminally.ngrok-free.app",
            "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36",
            "content-length": "278",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "en-GB,en-US;q=0.9,en;q=0.8,hr;q=0.7",
            "content-type": "application/json",
            "ngrok-skip-browser-warning": "true",
            "origin": "https://et.q.agency",
            "priority": "u=1, i",
            "referer": "https://et.q.agency/",
            "sec-ch-ua": "\"Chromium\";v=\"142\", \"Google Chrome\";v=\"142\", \"Not_A Brand\";v=\"99\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"macOS\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "x-forwarded-for": "213.186.16.164",
            "x-forwarded-host": "infinite-wasp-terminally.ngrok-free.app",
            "x-forwarded-proto": "https"
          },
          "params": {},
          "query": {},
          "body": {
            "sessionId": "fe5omlhxqzg",
            "md5": "dbbb06b4085ba643fb35e9e0ff2b5b92",
            "fileName": "GreenLeaf-Short.pdf",
            "date": "2025-12-03 11:58:37",
            "link": "https://wrdntxsgwastvpyxdnmq.supabase.co/storage/v1/object/public/rfps/rfp_greenleaf_short_dbbb.pdf",
            "indexName": "rfp_greenleaf_short_dbbb"
          },
          "webhookUrl": "https://infinite-wasp-terminally.ngrok-free.app/webhook/rfp-analyse",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo_name": "n8n-backup-zm",
  "repo_owner": "zlatkomq",
  "repo_path": "",
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "052VdzVIz9bFK2dw"
  },
  "shared": [
    {
      "updatedAt": "2025-11-11T13:21:49.057Z",
      "createdAt": "2025-11-11T13:21:49.057Z",
      "role": "workflow:owner",
      "workflowId": "Ky1AiuIMbY1zoTLE",
      "projectId": "NM7VZoSXkcKo262s"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "updatedAt": "2025-04-24T10:59:44.979Z",
      "createdAt": "2025-04-24T10:59:44.979Z",
      "id": "qEREEA2JvunvA9Nv",
      "name": "Estimation Tool"
    }
  ],
  "triggerCount": 2,
  "updatedAt": "2025-12-03T12:01:56.142Z",
  "versionId": "0fa33635-8c29-4ad2-9372-0744e859f4aa"
}